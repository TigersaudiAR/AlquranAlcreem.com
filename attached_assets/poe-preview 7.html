<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تطبيق القرآن الكريم التعليمي</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Amiri&amp;family=Scheherazade+New&amp;family=Tajawal:wght@400;500;700&amp;display=swap" rel="stylesheet">
  
  <!-- React and ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  
  <!-- Marked for Markdown parsing -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
    }
    
    .arabic-text {
      font-family: 'Amiri', 'Scheherazade New', serif;
      line-height: 1.8;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #5D5CDE;
      border-radius: 4px;
    }
    
    .dark ::-webkit-scrollbar-track {
      background: #2d2d2d;
    }
    
    /* Quran pages styling */
    .quran-page {
      background-color: #FAF6E9;
      background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1IiBoZWlnaHQ9IjUiPgo8cmVjdCB3aWR0aD0iNSIgaGVpZ2h0PSI1IiBmaWxsPSIjZmFmNmU5Ij48L3JlY3Q+CjxyZWN0IHdpZHRoPSIxIiBoZWlnaHQ9IjEiIGZpbGw9IiNlZmVhZDQiPjwvcmVjdD4KPC9zdmc+');
      border: 1px solid #E6DFC8;
      border-radius: 5px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .dark .quran-page {
      background-color: #2D2D2D;
      background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1IiBoZWlnaHQ9IjUiPgo8cmVjdCB3aWR0aD0iNSIgaGVpZ2h0PSI1IiBmaWxsPSIjMmQyZDJkIj48L3JlY3Q+CjxyZWN0IHdpZHRoPSIxIiBoZWlnaHQ9IjEiIGZpbGw9IiMzYTNhM2EiPjwvcmVjdD4KPC9zdmc+');
      border-color: #444;
    }
    
    /* Mushaf view frame */
    .mushaf-frame {
      background-color: #8B5A2B;
      background-image: linear-gradient(45deg, #8B5A2B 25%, #A67C52 25%, #A67C52 50%, #8B5A2B 50%, #8B5A2B 75%, #A67C52 75%, #A67C52 100%);
      background-size: 10px 10px;
      padding: 10px;
      border-radius: 8px;
    }
    
    .dark .mushaf-frame {
      background-color: #3D2914;
      background-image: linear-gradient(45deg, #3D2914 25%, #53381D 25%, #53381D 50%, #3D2914 50%, #3D2914 75%, #53381D 75%, #53381D 100%);
    }

    /* Prayer time display animation */
    @keyframes prayerPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .prayer-active {
      animation: prayerPulse 2s infinite;
    }
    
    /* Dream interpretation input focus effect */
    .dream-input:focus {
      box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.3);
    }
    
    /* Hajj map container */
    .hajj-map-container {
      position: relative;
      width: 100%;
      height: 300px;
      background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8ZGVmcz4KICA8cGF0dGVybiBpZD0ic21hbGwtZ3JpZCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEwIiBwYXR0ZXJuVW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KICAgIDxwYXRoIGQ9Ik0gMTAgMCBMIDAgMCAwIDEwIiBmaWxsPSJub25lIiBzdHJva2U9IiNlMGUwZTAiIHN0cm9rZS13aWR0aD0iMC41Ii8+CiAgPC9wYXR0ZXJuPgogIDxwYXR0ZXJuIGlkPSJncmlkIiB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CiAgICA8cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0idXJsKCNzbWFsbC1ncmlkKSIvPgogICAgPHBhdGggZD0iTSAxMDAgMCBMIDAgMCAwIDEwMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjY2NjY2NjIiBzdHJva2Utd2lkdGg9IjEiLz4KICA8L3BhdHRlcm4+CjwvZGVmcz4KPHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNncmlkKSIgLz4KPC9zdmc+');
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    
    .dark .hajj-map-container {
      background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8ZGVmcz4KICA8cGF0dGVybiBpZD0ic21hbGwtZ3JpZCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEwIiBwYXR0ZXJuVW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KICAgIDxwYXRoIGQ9Ik0gMTAgMCBMIDAgMCAwIDEwIiBmaWxsPSJub25lIiBzdHJva2U9IiMzMzMzMzMiIHN0cm9rZS13aWR0aD0iMC41Ii8+CiAgPC9wYXR0ZXJuPgogIDxwYXR0ZXJuIGlkPSJncmlkIiB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CiAgICA8cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0idXJsKCNzbWFsbC1ncmlkKSIvPgogICAgPHBhdGggZD0iTSAxMDAgMCBMIDAgMCAwIDEwMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNDQ0NDQ0IiBzdHJva2Utd2lkdGg9IjEiLz4KICA8L3BhdHRlcm4+CjwvZGVmcz4KPHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNncmlkKSIgLz4KPC9zdmc+');
      border-color: #444;
    }
    
    /* Memory circles UI */
    .memory-circle {
      transition: all 0.3s ease;
    }
    
    .memory-circle:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    /* Audio player custom styling */
    .custom-audio-player {
      --player-bg: #10B981;
      --player-text: white;
      --player-bg-hover: #059669;
      --progress-bg: rgba(255,255,255,0.2);
      --progress-fill: white;
      border-radius: 12px;
      overflow: hidden;
    }
    
    .dark .custom-audio-player {
      --player-bg: #065F46;
      --player-text: #E2E8F0;
      --player-bg-hover: #047857;
      --progress-bg: rgba(255,255,255,0.1);
      --progress-fill: #E2E8F0;
    }
    
    .circle-progress {
      stroke-dasharray: 140;
      stroke-dashoffset: 140;
      transform: rotate(-90deg);
      transform-origin: center;
      transition: stroke-dashoffset 0.3s ease;
    }
  </style>
  
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#5D5CDE',
            secondary: '#10B981',
          },
          fontFamily: {
            arabic: ['Amiri', 'Scheherazade New', 'serif'],
          }
        }
      }
    }
    
    // Check for dark mode preference
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.classList.add('dark');
    }
    
    // Listen for changes in color scheme preference
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
      if (event.matches) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    });
  </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white">
  <div id="app"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;
    
    // Initialize lucide icons
    lucide.createIcons();
    
    // تكوين التطبيق الرئيسي
    const APP_CONFIG = {
      version: '1.4.0',
      name: 'تطبيق القرآن الكريم التعليمي',
      developer: 'عبدالرحمن عوض صالح الرشيدي للبرمجة وتطوير',
      // API URLs حية وفعالة
      quranAPI: 'https://api.alquran.cloud/v1/',
      quranTranslationAPI: 'https://api.alquran.cloud/v1/quran/',
      tafsirAPI: 'https://api.quran.com/api/v4/',
      prayerAPI: 'https://api.aladhan.com/v1/',
      hadithAPI: 'https://api.hadith.gading.dev/books/',
      audioBaseURL: 'https://cdn.islamic.network/quran/audio/128/',
      copyright: {
        year: new Date().getFullYear(),
        owner: "عبدالرحمن عوض صالح الرشيدي للبرمجة وتطوير",
        phone: "+966 599900121",
        email: "Tiger3Saudi@gmail.com",
        location: "المملكة العربية السعودية، الرياض",
        rights: "جميع الحقوق محفوظة"
      }
    };

    // قائمة القراء مع روابط الصوت الحية
    const RECITERS = [
      { id: 'ar.alafasy', name: 'مشاري راشد العفاسي', language: 'ar' },
      { id: 'ar.abdulbasitmurattal', name: 'عبد الباسط عبد الصمد', language: 'ar' },
      { id: 'ar.abdurrahmaansudais', name: 'عبد الرحمن السديس', language: 'ar' },
      { id: 'ar.hanirifai', name: 'هاني الرفاعي', language: 'ar' },
      { id: 'ar.husary', name: 'محمود خليل الحصري', language: 'ar' },
      { id: 'ar.mahermuaiqly', name: 'ماهر المعيقلي', language: 'ar' },
      { id: 'ar.minshawi', name: 'محمد صديق المنشاوي', language: 'ar' },
      { id: 'ar.muhammadayyoub', name: 'محمد أيوب', language: 'ar' },
    ];

    // بيانات اللغات والترجمات المتاحة
    const LANGUAGES = [
      { code: 'ar', name: 'العربية', direction: 'rtl', translation: 'ar.asad' },
      { code: 'en', name: 'English', direction: 'ltr', translation: 'en.sahih' },
      { code: 'fr', name: 'Français', direction: 'ltr', translation: 'fr.hamidullah' },
      { code: 'ur', name: 'اردو', direction: 'rtl', translation: 'ur.jalandhry' },
      { code: 'id', name: 'Bahasa Indonesia', direction: 'ltr', translation: 'id.indonesian' },
    ];
    
    // مكوّن عارض الأخطاء
    const ErrorDisplay = ({ error, onRetry, retryText = "إعادة المحاولة" }) => (
      <div className="bg-red-100 dark:bg-red-900 p-6 rounded-lg text-center">
        <lucide-alert-triangle className="w-12 h-12 text-red-600 dark:text-red-400 mx-auto mb-3" />
        <div className="text-red-600 dark:text-red-400 font-bold text-lg mb-2">حدث خطأ!</div>
        <div className="text-red-700 dark:text-red-300 mb-4">{error}</div>
        {onRetry && (
          <button 
            onClick={onRetry}
            className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg"
          >
            {retryText}
          </button>
        )}
      </div>
    );
    
    // مكوّن الإشعارات
    const Toast = ({ message, type = 'success', onClose }) => {
      useEffect(() => {
        const timer = setTimeout(() => {
          onClose();
        }, 3000);
        
        return () => clearTimeout(timer);
      }, [onClose]);
      
      return (
        <div className={`fixed bottom-4 right-4 z-50 p-3 rounded-lg shadow-lg flex items-center gap-2 ${
          type === 'success' ? 'bg-emerald-600 text-white' :
          type === 'error' ? 'bg-red-600 text-white' :
          'bg-amber-600 text-white'
        }`}>
          {type === 'success' ? <lucide-check className="w-5 h-5" /> :
           type === 'error' ? <lucide-x className="w-5 h-5" /> :
           <lucide-alert-triangle className="w-5 h-5" />}
          <span>{message}</span>
          <button onClick={onClose} className="ml-2 p-1 hover:bg-white hover:bg-opacity-20 rounded-full">
            <lucide-x className="w-4 h-4" />
          </button>
        </div>
      );
    };

    // مكون تحميل البيانات
    const LoadingSpinner = ({ text = 'جاري التحميل...' }) => (
      <div className="flex flex-col items-center justify-center p-8">
        <div className="w-12 h-12 border-4 border-emerald-200 border-t-emerald-600 rounded-full animate-spin mb-4"></div>
        <div className="text-emerald-700 dark:text-emerald-400 font-bold">{text}</div>
      </div>
    );

    // مكون مواقيت الصلاة - تم تحسينه للاتصال بالواجهة البرمجية الحية
    const PrayerTimes = () => {
      const [prayerTimes, setPrayerTimes] = useState({
        fajr: '--:--',
        dhuhr: '--:--',
        asr: '--:--',
        maghrib: '--:--',
        isha: '--:--',
        nextPrayer: null,
        countdown: '--:--'
      });
      
      const [location, setLocation] = useState({
        latitude: 24.7136,
        longitude: 46.6753,
        cityName: 'جاري تحديد الموقع...',
        countryCode: 'SA'
      });
      
      const [qiblaDirection, setQiblaDirection] = useState(0);
      const [isLoading, setIsLoading] = useState(true);
      const [error, setError] = useState(null);
      const countdownIntervalRef = useRef(null);
      
      useEffect(() => {
        // الحصول على الموقع الجغرافي للمستخدم
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const lat = position.coords.latitude;
              const lng = position.coords.longitude;
              setLocation(prev => ({ ...prev, latitude: lat, longitude: lng }));
              fetchLocationName(lat, lng);
              calculateQiblaDirection(lat, lng);
              fetchPrayerTimes(lat, lng);
            },
            (error) => {
              console.error("خطأ في الحصول على الموقع:", error);
              // استخدام الموقع الافتراضي (الرياض)
              setError("تعذر الحصول على موقعك الحالي. تم استخدام الموقع الافتراضي (الرياض).");
              fetchPrayerTimes(location.latitude, location.longitude);
              calculateQiblaDirection(location.latitude, location.longitude);
            },
            { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
          );
        } else {
          setError("المتصفح لا يدعم تحديد الموقع. تم استخدام الموقع الافتراضي (الرياض).");
          fetchPrayerTimes(location.latitude, location.longitude);
          calculateQiblaDirection(location.latitude, location.longitude);
        }
        
        return () => {
          if (countdownIntervalRef.current) {
            clearInterval(countdownIntervalRef.current);
          }
        };
      }, []);
      
      // استرجاع اسم المدينة من الإحداثيات
      const fetchLocationName = async (lat, lng) => {
        try {
          const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=ar`);
          
          if (!response.ok) {
            throw new Error(`فشل الاستعلام: ${response.status}`);
          }
          
          const data = await response.json();
          
          // محاولة الحصول على اسم المدينة أو البلدة أو القرية أو المحافظة
          const city = data.address.city || data.address.town || data.address.village || data.address.state || data.address.county;
          const country_code = data.address.country_code;
          
          if (city) {
            setLocation(prev => ({ ...prev, cityName: city, countryCode: country_code }));
          } else {
            setLocation(prev => ({ ...prev, cityName: data.display_name.split(',')[0] }));
          }
        } catch (error) {
          console.error("خطأ في جلب اسم الموقع:", error);
          setError("تعذر الحصول على اسم موقعك الحالي.");
        }
      };
      
      // حساب اتجاه القبلة باستخدام صيغة الاتجاه العظمى
      const calculateQiblaDirection = (lat, lng) => {
        try {
          // إحداثيات الكعبة المشرفة (مكة المكرمة)
          const kaabaLat = 21.4225; // خط عرض الكعبة (بالدرجات)
          const kaabaLng = 39.8262; // خط طول الكعبة (بالدرجات)
          
          // تحويل الإحداثيات من درجات إلى راديان
          const latRad = lat * (Math.PI / 180);
          const lngRad = lng * (Math.PI / 180);
          const kaabaLatRad = kaabaLat * (Math.PI / 180);
          const kaabaLngRad = kaabaLng * (Math.PI / 180);
          
          // حساب اتجاه القبلة باستخدام صيغة الاتجاه العظمى (Great Circle Formula)
          const y = Math.sin(kaabaLngRad - lngRad);
          const x = (Math.cos(latRad) * Math.tan(kaabaLatRad)) - 
                    (Math.sin(latRad) * Math.cos(kaabaLngRad - lngRad));
          
          // حساب الاتجاه بالراديان ثم تحويله إلى درجات
          let qiblaAngle = Math.atan2(y, x) * (180 / Math.PI);
          
          // تعديل القيمة إلى النطاق 0-360 درجة
          qiblaAngle = (qiblaAngle + 360) % 360;
          
          setQiblaDirection(qiblaAngle);
        } catch (error) {
          console.error("خطأ في حساب اتجاه القبلة:", error);
          setError("تعذر حساب اتجاه القبلة بدقة.");
          // استخدام قيمة افتراضية لاتجاه القبلة في الرياض
          setQiblaDirection(245.1);
        }
      };
      
      // جلب مواقيت الصلاة من API وقت الصلاة
      const fetchPrayerTimes = async (lat, lng) => {
        setIsLoading(true);
        try {
          const today = new Date();
          const formattedDate = `${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}`;
          
          // استخدام API مواقيت الصلاة الحي
          const url = `${APP_CONFIG.prayerAPI}timings/${formattedDate}?latitude=${lat}&longitude=${lng}&method=4`;
          const response = await fetch(url);
          
          if (!response.ok) {
            throw new Error(`فشل الاستعلام: ${response.status}`);
          }
          
          const data = await response.json();
          
          if (data.code === 200 && data.data && data.data.timings) {
            const timings = data.data.timings;
            
            // تخزين أوقات الصلوات
            setPrayerTimes(prev => ({
              ...prev,
              fajr: timings.Fajr,
              dhuhr: timings.Dhuhr,
              asr: timings.Asr,
              maghrib: timings.Maghrib,
              isha: timings.Isha
            }));
            
            // حساب الصلاة التالية والعد التنازلي
            calculateNextPrayer(timings);
            
            // تحديث العد التنازلي كل دقيقة
            if (countdownIntervalRef.current) {
              clearInterval(countdownIntervalRef.current);
            }
            
            countdownIntervalRef.current = setInterval(() => {
              updateCountdown(timings);
            }, 60000);
          } else {
            throw new Error("بيانات غير صالحة من API");
          }
        } catch (error) {
          console.error("خطأ في جلب مواقيت الصلاة:", error);
          setError("تعذر الحصول على مواقيت الصلاة. يرجى التحقق من اتصالك بالإنترنت.");
          
          // استخدام بيانات افتراضية
          setPrayerTimes({
            fajr: '04:30',
            dhuhr: '12:10',
            asr: '15:45',
            maghrib: '19:20',
            isha: '20:50',
            nextPrayer: 'asr',
            countdown: '--:--'
          });
        } finally {
          setIsLoading(false);
        }
      };
      
      // تحديد الصلاة التالية وحساب العد التنازلي
      const calculateNextPrayer = (timings) => {
        try {
          const now = new Date();
          const currentHour = now.getHours();
          const currentMinute = now.getMinutes();
          const currentTime = currentHour * 60 + currentMinute; // الوقت الحالي بالدقائق
          
          const prayers = [
            { name: 'fajr', arabicName: 'الفجر', time: timings.Fajr },
            { name: 'dhuhr', arabicName: 'الظهر', time: timings.Dhuhr },
            { name: 'asr', arabicName: 'العصر', time: timings.Asr },
            { name: 'maghrib', arabicName: 'المغرب', time: timings.Maghrib },
            { name: 'isha', arabicName: 'العشاء', time: timings.Isha }
          ];
          
          // تحويل أوقات الصلاة إلى دقائق
          const prayerMinutes = prayers.map(prayer => {
            const [hour, minute] = prayer.time.split(':');
            return {
              name: prayer.name,
              arabicName: prayer.arabicName,
              minutes: parseInt(hour) * 60 + parseInt(minute)
            };
          });
          
          // ترتيب الصلوات حسب الوقت
          prayerMinutes.sort((a, b) => a.minutes - b.minutes);
          
          // تحديد الصلاة التالية
          let nextPrayer = null;
          for (let prayer of prayerMinutes) {
            if (prayer.minutes > currentTime) {
              nextPrayer = prayer;
              break;
            }
          }
          
          // إذا تجاوزنا آخر صلاة في اليوم، فالصلاة التالية هي الفجر غدًا
          if (!nextPrayer) {
            nextPrayer = prayerMinutes[0]; // الفجر
            // إضافة 24 ساعة للوقت
            nextPrayer.minutes += 24 * 60;
          }
          
          // حساب الوقت المتبقي
          const remainingMinutes = nextPrayer.minutes - currentTime;
          const hours = Math.floor(remainingMinutes / 60);
          const minutes = remainingMinutes % 60;
          
          setPrayerTimes(prev => ({
            ...prev,
            nextPrayer: nextPrayer.name,
            nextPrayerArabic: nextPrayer.arabicName,
            countdown: `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`
          }));
        } catch (error) {
          console.error("خطأ في حساب الصلاة التالية:", error);
          setError("تعذر حساب وقت الصلاة التالية.");
        }
      };
      
      // تحديث العد التنازلي
      const updateCountdown = (timings) => {
        calculateNextPrayer(timings);
      };
      
      if (isLoading) {
        return <LoadingSpinner text="جاري تحميل مواقيت الصلاة..." />;
      }
      
      return (
        <div className="rounded-lg p-4 mb-6 bg-gradient-to-r from-emerald-700 to-emerald-900 text-white">
          <div className="flex justify-between items-center mb-3">
            <h2 className="text-lg font-bold">مواعيد الصلاة</h2>
            <div className="flex items-center">
              <div className="bg-white bg-opacity-20 rounded-full px-3 py-1 text-sm ml-2">
                <lucide-clock className="w-4 h-4 inline ml-1" />
                <span>{prayerTimes.countdown}</span> لصلاة {prayerTimes.nextPrayerArabic}
              </div>
            </div>
          </div>
          
          <div className="flex flex-wrap justify-between">
            <div className="w-full md:w-8/12">
              <div className="flex flex-wrap justify-between">
                <div className={`rounded-lg px-3 py-2 text-center mb-2 w-1/5 ${prayerTimes.nextPrayer === 'fajr' ? 'bg-amber-500 text-emerald-900 prayer-active' : 'bg-white bg-opacity-10'}`}>
                  <div className="text-xs md:text-sm">الفجر</div>
                  <div className="text-sm md:text-base">{prayerTimes.fajr}</div>
                </div>
                <div className={`rounded-lg px-3 py-2 text-center mb-2 w-1/5 ${prayerTimes.nextPrayer === 'dhuhr' ? 'bg-amber-500 text-emerald-900 prayer-active' : 'bg-white bg-opacity-10'}`}>
                  <div className="text-xs md:text-sm">الظهر</div>
                  <div className="text-sm md:text-base">{prayerTimes.dhuhr}</div>
                </div>
                <div className={`rounded-lg px-3 py-2 text-center mb-2 w-1/5 ${prayerTimes.nextPrayer === 'asr' ? 'bg-amber-500 text-emerald-900 prayer-active' : 'bg-white bg-opacity-10'}`}>
                  <div className="text-xs md:text-sm">العصر</div>
                  <div className="text-sm md:text-base">{prayerTimes.asr}</div>
                </div>
                <div className={`rounded-lg px-3 py-2 text-center mb-2 w-1/5 ${prayerTimes.nextPrayer === 'maghrib' ? 'bg-amber-500 text-emerald-900 prayer-active' : 'bg-white bg-opacity-10'}`}>
                  <div className="text-xs md:text-sm">المغرب</div>
                  <div className="text-sm md:text-base">{prayerTimes.maghrib}</div>
                </div>
                <div className={`rounded-lg px-3 py-2 text-center mb-2 w-1/5 ${prayerTimes.nextPrayer === 'isha' ? 'bg-amber-500 text-emerald-900 prayer-active' : 'bg-white bg-opacity-10'}`}>
                  <div className="text-xs md:text-sm">العشاء</div>
                  <div className="text-sm md:text-base">{prayerTimes.isha}</div>
                </div>
              </div>
              <div className="mt-2 text-center text-sm text-white text-opacity-80">
                <lucide-map-pin className="w-4 h-4 inline ml-1" />
                {location.cityName}
              </div>
            </div>
            
            <div className="w-full md:w-4/12 flex justify-center">
              <div className="text-center">
                <h2 className="text-lg font-bold mb-2">اتجاه القبلة</h2>
                <div className="relative w-24 h-24 mx-auto rounded-full bg-gradient-to-r from-emerald-700 to-emerald-900 border-4 border-amber-500">
                  <div 
                    className="absolute w-2 h-12 bg-amber-500 top-2 left-1/2 origin-bottom" 
                    style={{ transform: `translateX(-50%) rotate(${qiblaDirection}deg)` }}
                  ></div>
                  <div className="absolute w-4 h-4 bg-amber-500 rounded-full top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"></div>
                </div>
                <div className="mt-1 text-sm">{Math.round(qiblaDirection)}° من الشمال</div>
              </div>
            </div>
          </div>
          
          {error && (
            <div className="mt-3 text-amber-200 text-sm text-center">
              <lucide-alert-triangle className="w-4 h-4 inline ml-1" />
              {error}
            </div>
          )}
        </div>
      );
    };

    // قائمة السور الاحتياطية - للاستخدام في حالة فشل الاتصال بالواجهة البرمجية
    const FALLBACK_SURAHS = [
      {number: 1, name: "الفاتحة", englishName: "Al-Fatiha", numberOfAyahs: 7, revelationType: "Meccan"},
      {number: 2, name: "البقرة", englishName: "Al-Baqara", numberOfAyahs: 286, revelationType: "Medinan"},
      {number: 3, name: "آل عمران", englishName: "Aal-Imran", numberOfAyahs: 200, revelationType: "Medinan"},
      {number: 4, name: "النساء", englishName: "An-Nisa", numberOfAyahs: 176, revelationType: "Medinan"},
      {number: 5, name: "المائدة", englishName: "Al-Ma'ida", numberOfAyahs: 120, revelationType: "Medinan"},
      {number: 6, name: "الأنعام", englishName: "Al-An'am", numberOfAyahs: 165, revelationType: "Meccan"},
      {number: 7, name: "الأعراف", englishName: "Al-A'raf", numberOfAyahs: 206, revelationType: "Meccan"},
      {number: 8, name: "الأنفال", englishName: "Al-Anfal", numberOfAyahs: 75, revelationType: "Medinan"},
      {number: 9, name: "التوبة", englishName: "At-Tawba", numberOfAyahs: 129, revelationType: "Medinan"},
      {number: 10, name: "يونس", englishName: "Yunus", numberOfAyahs: 109, revelationType: "Meccan"},
      {number: 11, name: "هود", englishName: "Hud", numberOfAyahs: 123, revelationType: "Meccan"},
      {number: 12, name: "يوسف", englishName: "Yusuf", numberOfAyahs: 111, revelationType: "Meccan"},
      {number: 13, name: "الرعد", englishName: "Ar-Ra'd", numberOfAyahs: 43, revelationType: "Medinan"},
      {number: 14, name: "إبراهيم", englishName: "Ibrahim", numberOfAyahs: 52, revelationType: "Meccan"},
      {number: 15, name: "الحجر", englishName: "Al-Hijr", numberOfAyahs: 99, revelationType: "Meccan"},
      // وهكذا مع بقية السور - تم اختصارها هنا
    ];

    // النص القرآني الافتراضي للسور الأكثر شيوعاً - للاستخدام في حالة فشل الاتصال بالواجهة البرمجية
    const FALLBACK_AYAHS = {
      // سورة الفاتحة
      1: [
        { number: 1, numberInSurah: 1, text: "بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ" },
        { number: 2, numberInSurah: 2, text: "ٱلْحَمْدُ لِلَّهِ رَبِّ ٱلْعَٰلَمِينَ" },
        { number: 3, numberInSurah: 3, text: "ٱلرَّحْمَٰنِ ٱلرَّحِيمِ" },
        { number: 4, numberInSurah: 4, text: "مَٰلِكِ يَوْمِ ٱلدِّينِ" },
        { number: 5, numberInSurah: 5, text: "إِيَّاكَ نَعْبُدُ وَإِيَّاكَ نَسْتَعِينُ" },
        { number: 6, numberInSurah: 6, text: "ٱهْدِنَا ٱلصِّرَٰطَ ٱلْمُسْتَقِيمَ" },
        { number: 7, numberInSurah: 7, text: "صِرَٰطَ ٱلَّذِينَ أَنْعَمْتَ عَلَيْهِمْ غَيْرِ ٱلْمَغْضُوبِ عَلَيْهِمْ وَلَا ٱلضَّآلِّينَ" }
      ],
      // وهكذا مع بقية السور - تم اختصارها هنا
    };

    // مكون قائمة السور مع اتصال بالواجهة البرمجية الحية
    const SurahList = ({ onSelectSurah }) => {
      const [surahs, setSurahs] = useState(FALLBACK_SURAHS); // استخدام القائمة الاحتياطية كقيمة مبدئية
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [searchQuery, setSearchQuery] = useState('');
      const [useFallback, setUseFallback] = useState(false);
      
      useEffect(() => {
        fetchSurahList();
      }, []);
      
      const fetchSurahList = async () => {
        setLoading(true);
        setError(null);
        try {
          // استخدام واجهة برمجية حية لجلب قائمة السور
          const response = await fetch(`${APP_CONFIG.quranAPI}surah`);
          
          if (!response.ok) {
            throw new Error(`فشل الاستعلام: ${response.status}`);
          }
          
          const data = await response.json();
          
          if (data.code === 200 && data.data) {
            setSurahs(data.data);
            setUseFallback(false);
          } else {
            throw new Error("بيانات غير صالحة من API");
          }
        } catch (error) {
          console.error("خطأ في جلب قائمة السور:", error);
          // استخدام القائمة الاحتياطية في حالة فشل الاستعلام
          setSurahs(FALLBACK_SURAHS);
          setUseFallback(true);
          setError("تم استخدام قائمة السور المخزنة محلياً بسبب مشكلة في الاتصال بالإنترنت.");
        } finally {
          setLoading(false);
        }
      };
      
      const filteredSurahs = surahs.filter(surah => 
        surah.name.includes(searchQuery) || 
        surah.englishName.toLowerCase().includes(searchQuery.toLowerCase()) ||
        surah.number.toString().includes(searchQuery)
      );
      
      if (loading) {
        return <LoadingSpinner text="جاري تحميل قائمة السور..." />;
      }
      
      return (
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
          {error && (
            <div className="mb-4 bg-yellow-100 dark:bg-yellow-900 p-3 rounded-lg text-yellow-800 dark:text-yellow-200 text-sm">
              <lucide-alert-triangle className="w-4 h-4 inline ml-1" />
              {error}
              {useFallback && (
                <button 
                  onClick={fetchSurahList}
                  className="mr-2 underline text-blue-600 dark:text-blue-400 hover:text-blue-800"
                >
                  محاولة الاتصال مرة أخرى
                </button>
              )}
            </div>
          )}
        
          <div className="mb-4">
            <input
              type="text"
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              placeholder="ابحث عن سورة..."
              className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 dark:bg-gray-700 dark:text-white text-base"
            />
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
            {filteredSurahs.length > 0 ? (
              filteredSurahs.map((surah) => (
                <div 
                  key={surah.number}
                  onClick={() => onSelectSurah(surah.number)}
                  className="bg-emerald-50 dark:bg-emerald-900 p-3 rounded-lg flex justify-between items-center cursor-pointer hover:bg-emerald-100 dark:hover:bg-emerald-800 transition-colors"
                >
                  <div className="flex items-center">
                    <div className="w-8 h-8 bg-emerald-600 text-white rounded-full flex items-center justify-center ml-2">
                      {surah.number}
                    </div>
                    <div>
                      <div className="font-bold">{surah.name}</div>
                      <div className="text-gray-600 dark:text-gray-400 text-sm">{surah.englishName}</div>
                    </div>
                  </div>
                  <div className="text-gray-600 dark:text-gray-400 text-sm">
                    {surah.numberOfAyahs} آية
                    <lucide-chevron-right className="w-4 h-4 inline mr-1" />
                  </div>
                </div>
              ))
            ) : (
              <div className="col-span-3 text-center p-8 text-gray-500 dark:text-gray-400">
                لا توجد نتائج تطابق بحثك. حاول استخدام كلمات بحث أخرى.
              </div>
            )}
          </div>
        </div>
      );
    };

    // مكون البحث في القرآن مع اتصال بالواجهة البرمجية الحية
    const QuranSearch = ({ onResults }) => {
      const [query, setQuery] = useState('');
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);
      
      const handleSearch = async (e) => {
        e.preventDefault();
        
        if (!query.trim()) {
          return;
        }
        
        setLoading(true);
        setError(null);
        
        try {
          // البحث عن الآيات باستخدام API حي
          const response = await fetch(`${APP_CONFIG.tafsirAPI}search?q=${encodeURIComponent(query)}&language=ar&size=20`);
          
          if (!response.ok) {
            throw new Error(`فشل الاستعلام: ${response.status}`);
          }
          
          const data = await response.json();
          
          if (data.search && data.search.results) {
            onResults(data.search.results);
          } else {
            onResults([]);
          }
        } catch (error) {
          console.error("خطأ في البحث:", error);
          setError("تعذر إجراء البحث. يرجى التحقق من اتصالك بالإنترنت والمحاولة مرة أخرى.");
        } finally {
          setLoading(false);
        }
      };
      
      return (
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-3 mb-6">
          <form onSubmit={handleSearch}>
            <div className="flex">
              <input
                type="text"
                value={query}
                onChange={(e) => setQuery(e.target.value)}
                placeholder="ابحث في القرآن الكريم..."
                className="flex-grow p-2 border border-gray-300 dark:border-gray-600 rounded-r-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 dark:bg-gray-700 dark:text-white text-base"
                disabled={loading}
              />
              <button
                type="submit"
                className={`${loading ? 'bg-gray-500' : 'bg-emerald-600 hover:bg-emerald-700'} text-white px-4 py-2 rounded-l-lg`}
                disabled={loading}
              >
                {loading ? 'جاري البحث...' : '🔍 بحث'}
              </button>
            </div>
          </form>
          
          {error && (
            <div className="mt-3 text-red-600 dark:text-red-400 text-sm">
              <lucide-alert-triangle className="w-4 h-4 inline ml-1" />
              {error}
            </div>
          )}
        </div>
      );
    };

    // نتائج البحث
    const SearchResults = ({ results, onSelectAyah }) => {
      if (!results || results.length === 0) {
        return (
          <div className="bg-amber-50 dark:bg-amber-900 rounded-lg p-4 mb-6 text-center">
            <div className="text-amber-700 dark:text-amber-300 font-bold mb-2">لم يتم العثور على نتائج</div>
            <div className="text-amber-800 dark:text-amber-200">
              حاول استخدام كلمات بحث أخرى أو تأكد من صحة ما تبحث عنه.
            </div>
          </div>
        );
      }
      
      return (
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 mb-6">
          <h3 className="text-xl font-bold mb-4 text-emerald-700 dark:text-emerald-400">نتائج البحث</h3>
          <div className="text-gray-600 dark:text-gray-400 mb-4">
            تم العثور على {results.length} نتيجة
          </div>
          
          <div className="space-y-4">
            {results.map((result, index) => (
              <div 
                key={index}
                className="p-3 border-r-4 border-emerald-500 bg-emerald-50 dark:bg-emerald-900 hover:bg-emerald-100 dark:hover:bg-emerald-800 rounded-lg cursor-pointer"
                onClick={() => onSelectAyah(result.verse_key)}
              >
                <div className="flex justify-between mb-2">
                  <div className="font-bold text-emerald-700 dark:text-emerald-400">
                    سورة {result.verse.translations[0]?.surah_name || result.verse_key.split(':')[0]} | الآية {result.verse_key.split(':')[1]}
                  </div>
                </div>
                <div className="text-gray-800 dark:text-gray-200 mb-2 arabic-text">
                  {result.text}
                </div>
                <div className="text-sm text-gray-600 dark:text-gray-400">
                  انقر لعرض الآية في سياقها
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    };

    // القسم الرئيسي
    const MainSections = ({ onSectionSelect }) => {
      const sections = [
        { id: 'quran', name: 'القرآن الكريم', icon: '📖' },
        { id: 'memorization', name: 'حلقات التحفيظ', icon: '👥' },
        { id: 'learn-reading', name: 'تعلم القراءة', icon: '📚' },
        { id: 'virtual-classes', name: 'الفصول الافتراضية', icon: '🖥️' },
        { id: 'hajj-umrah', name: 'الحج والعمرة', icon: '🕋' },
        { id: 'educational', name: 'المواد التعليمية', icon: '🎓' },
        { id: 'ask-scholars', name: 'تواصل مع العلماء', icon: '👨‍🏫' },
        { id: 'dream-interpretation', name: 'تفسير الأحلام', icon: '💭' },
      ];
      
      return (
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
          {sections.map(section => (
            <div
              key={section.id}
              onClick={() => onSectionSelect(section.id)}
              className="bg-gradient-to-r from-emerald-700 to-emerald-900 text-white rounded-lg p-6 text-center cursor-pointer shadow-md hover:shadow-lg transform hover:-translate-y-1 transition-all"
            >
              <div className="text-3xl mb-3">{section.icon}</div>
              <h3 className="text-lg font-bold">{section.name}</h3>
            </div>
          ))}
        </div>
      );
    };

    // مكون القرآن الكريم (القسم الرئيسي) مع كافة وظائف الاتصال بالواجهات البرمجية
    const QuranSection = () => {
      const [view, setView] = useState('surah-list'); // surah-list, surah-view, search, mushaf
      const [viewMode, setViewMode] = useState('reading'); // reading, translation, tafsir, mushaf
      const [currentSurah, setCurrentSurah] = useState(1);
      const [currentPage, setCurrentPage] = useState(1);
      const [currentAyah, setCurrentAyah] = useState(1);
      const [currentReciter, setCurrentReciter] = useState(RECITERS[0].id);
      const [translationEdition, setTranslationEdition] = useState('en.sahih'); // Default translation
      const [searchResults, setSearchResults] = useState(null);
      const [toast, setToast] = useState(null);
      
      const handleSelectSurah = (surahNumber) => {
        setCurrentSurah(surahNumber);
        setCurrentAyah(1);
        setView('surah-view');
        setViewMode('reading');
      };
      
      const handleSelectAyahFromSearch = (verseKey) => {
        const [surahNumber, ayahNumber] = verseKey.split(':');
        setCurrentSurah(parseInt(surahNumber));
        setCurrentAyah(parseInt(ayahNumber));
        setView('surah-view');
        setViewMode('reading');
      };
      
      const handleBackToList = () => {
        setView('surah-list');
        setSearchResults(null);
      };
      
      const handleSearch = () => {
        setView('search');
      };
      
      const handleSearchResults = (results) => {
        setSearchResults(results);
      };
      
      const handleReciterChange = (reciterId) => {
        setCurrentReciter(reciterId);
        setToast({
          message: `تم تغيير القارئ إلى ${RECITERS.find(r => r.id === reciterId).name}`,
          type: 'success'
        });
      };
      
      const handleViewModeChange = (mode) => {
        setViewMode(mode);
        if (mode === 'mushaf' && view !== 'mushaf') {
          setView('mushaf');
        } else if (mode !== 'mushaf' && view === 'mushaf') {
          setView('surah-view');
        }
      };
      
      const handleTranslationChange = (edition) => {
        setTranslationEdition(edition);
        setToast({
          message: `تم تغيير الترجمة`,
          type: 'success'
        });
      };
      
      const clearToast = () => {
        setToast(null);
      };
      
      return (
        <div>
          <div className="flex flex-wrap justify-between items-center mb-4 gap-2">
            {view !== 'surah-list' && (
              <button 
                onClick={handleBackToList}
                className="flex items-center text-emerald-600 dark:text-emerald-400 hover:underline"
              >
                <lucide-arrow-left className="w-4 h-4 ml-1" />
                {view === 'search' ? 'العودة للقائمة الرئيسية' : 'العودة لقائمة السور'}
              </button>
            )}
            
            {/* Viewing modes */}
            {(view === 'surah-view' || view === 'mushaf') && (
              <div className="flex flex-wrap items-center justify-center gap-2">
                <div className="bg-gray-100 dark:bg-gray-700 rounded-lg p-1 flex">
                  <button 
                    onClick={() => handleViewModeChange('reading')}
                    className={`px-2 py-1 rounded-md text-sm ${viewMode === 'reading' ? 'bg-emerald-600 text-white' : 'text-gray-700 dark:text-gray-300'}`}
                  >
                    قراءة
                  </button>
                  <button 
                    onClick={() => handleViewModeChange('translation')}
                    className={`px-2 py-1 rounded-md text-sm ${viewMode === 'translation' ? 'bg-emerald-600 text-white' : 'text-gray-700 dark:text-gray-300'}`}
                  >
                    ترجمة
                  </button>
                  <button 
                    onClick={() => handleViewModeChange('tafsir')}
                    className={`px-2 py-1 rounded-md text-sm ${viewMode === 'tafsir' ? 'bg-emerald-600 text-white' : 'text-gray-700 dark:text-gray-300'}`}
                  >
                    تفسير
                  </button>
                  <button 
                    onClick={() => handleViewModeChange('mushaf')}
                    className={`px-2 py-1 rounded-md text-sm ${viewMode === 'mushaf' ? 'bg-emerald-600 text-white' : 'text-gray-700 dark:text-gray-300'}`}
                  >
                    مصحف
                  </button>
                </div>
                
                {viewMode === 'translation' && (
                  <select
                    value={translationEdition}
                    onChange={(e) => handleTranslationChange(e.target.value)}
                    className="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded text-sm py-1"
                  >
                    <option value="en.sahih">English - Sahih International</option>
                    <option value="fr.hamidullah">Français - Hamidullah</option>
                    <option value="ur.jalandhry">اردو - جالندہری</option>
                    <option value="id.indonesian">Bahasa Indonesia</option>
                    <option value="tr.ates">Türkçe - Süleyman Ateş</option>
                    <option value="ru.kuliev">Русский - Кулиев</option>
                  </select>
                )}
              </div>
            )}
            
            {view === 'surah-view' && (
              <div className="flex items-center">
                <label htmlFor="reciter" className="text-sm font-medium ml-2">القارئ:</label>
                <select
                  id="reciter"
                  value={currentReciter}
                  onChange={(e) => handleReciterChange(e.target.value)}
                  className="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded text-sm py-1"
                >
                  {RECITERS.map(reciter => (
                    <option key={reciter.id} value={reciter.id}>
                      {reciter.name}
                    </option>
                  ))}
                </select>
              </div>
            )}
            
            {view === 'surah-list' && (
              <button 
                onClick={handleSearch}
                className="flex items-center text-emerald-600 dark:text-emerald-400 hover:underline"
              >
                <span className="ml-1">🔍</span>
                بحث في القرآن
              </button>
            )}
          </div>
          
          {view === 'search' && (
            <>
              <QuranSearch onResults={handleSearchResults} />
              {searchResults && <SearchResults results={searchResults} onSelectAyah={handleSelectAyahFromSearch} />}
            </>
          )}
          
          {view === 'surah-list' && <SurahList onSelectSurah={handleSelectSurah} />}
          
          {view === 'surah-view' && (
            <SurahView 
              surahNumber={currentSurah} 
              initialAyah={currentAyah}
              reciterId={currentReciter}
              viewMode={viewMode}
              translationEdition={translationEdition}
            />
          )}
          
          {view === 'mushaf' && (
            <MushafView
              initialPage={currentPage}
              onPageChange={setCurrentPage}
            />
          )}
          
          {toast && (
            <Toast 
              message={toast.message} 
              type={toast.type} 
              onClose={clearToast} 
            />
          )}
        </div>
      );
    };

    // مكون المشغل الصوتي المخصص
    const CustomAudioPlayer = ({ audioSrc, onEnd }) => {
      const [isPlaying, setIsPlaying] = useState(false);
      const [currentTime, setCurrentTime] = useState(0);
      const [duration, setDuration] = useState(0);
      const [error, setError] = useState(null);
      const audioRef = useRef(null);
      
      useEffect(() => {
        if (audioSrc) {
          setCurrentTime(0);
          setDuration(0);
          
          // Reset player before loading new source
          if (audioRef.current) {
            audioRef.current.pause();
            audioRef.current.currentTime = 0;
            audioRef.current.src = audioSrc;
            audioRef.current.load();
          }
        }
      }, [audioSrc]);
      
      const togglePlay = () => {
        if (isPlaying) {
          audioRef.current.pause();
        } else {
          audioRef.current.play()
            .catch(err => {
              console.error("Error playing audio:", err);
              setError("تعذر تشغيل الصوت. يرجى التحقق من اتصالك بالإنترنت.");
            });
        }
      };
      
      const handleTimeUpdate = () => {
        setCurrentTime(audioRef.current.currentTime);
      };
      
      const handleDurationChange = () => {
        setDuration(audioRef.current.duration);
      };
      
      const handlePlayingStateChange = () => {
        setIsPlaying(!audioRef.current.paused);
      };
      
      const handleEnded = () => {
        setIsPlaying(false);
        if (onEnd) onEnd();
      };
      
      const handleSeek = (e) => {
        const seekPosition = e.target.value;
        audioRef.current.currentTime = seekPosition;
        setCurrentTime(seekPosition);
      };
      
      const formatTime = (seconds) => {
        if (isNaN(seconds)) return "00:00";
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = Math.floor(seconds % 60);
        return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
      };
      
      // Calculate progress percentage for circle progress
      const progressPercentage = duration ? (currentTime / duration) * 100 : 0;
      const circumference = 2 * Math.PI * 22; // Circle with radius 22
      const strokeDashoffset = circumference - (progressPercentage / 100) * circumference;
      
      return (
        <div className="custom-audio-player bg-gradient-to-r from-emerald-600 to-emerald-700 dark:from-emerald-700 dark:to-emerald-800 p-3 rounded-lg text-white mb-4">
          <audio
            ref={audioRef}
            src={audioSrc}
            onTimeUpdate={handleTimeUpdate}
            onDurationChange={handleDurationChange}
            onPlay={handlePlayingStateChange}
            onPause={handlePlayingStateChange}
            onEnded={handleEnded}
          />
          
          <div className="flex items-center gap-3">
            {/* Play/Pause Button with Circle Progress */}
            <div className="relative">
              <svg width="48" height="48" viewBox="0 0 48 48" className="transform -rotate-90">
                <circle 
                  cx="24" cy="24" r="22"
                  fill="transparent" 
                  stroke="rgba(255,255,255,0.2)" 
                  strokeWidth="3"
                />
                <circle 
                  cx="24" cy="24" r="22"
                  fill="transparent" 
                  stroke="white" 
                  strokeWidth="3"
                  strokeDasharray={`${circumference} ${circumference}`}
                  strokeDashoffset={strokeDashoffset}
                  className="transition-all duration-300 ease-linear"
                />
              </svg>
              <button
                onClick={togglePlay}
                className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-12 h-12 rounded-full flex items-center justify-center text-white"
              >
                {isPlaying ? (
                  <lucide-pause className="w-8 h-8" />
                ) : (
                  <lucide-play className="w-8 h-8 ml-1" />
                )}
              </button>
            </div>
            
            {/* Progress and Time Display */}
            <div className="flex-grow flex flex-col justify-center">
              <div className="flex justify-between text-xs mb-1">
                <span>{formatTime(currentTime)}</span>
                <span>{formatTime(duration)}</span>
              </div>
              <input
                type="range"
                min="0"
                max={duration || 100}
                value={currentTime}
                onChange={handleSeek}
                className="w-full h-2 bg-white bg-opacity-20 rounded-full appearance-none cursor-pointer"
                style={{
                  backgroundImage: `linear-gradient(to right, white ${progressPercentage}%, transparent ${progressPercentage}%)`,
                }}
              />
            </div>
          </div>
          
          {error && (
            <div className="mt-2 text-xs text-red-200">
              <lucide-alert-triangle className="w-3 h-3 inline ml-1" />
              {error}
            </div>
          )}
        </div>
      );
    };

    // مكون عرض المصحف - محسن مع دعم الصور الحقيقية
    const MushafView = ({ initialPage = 1, onPageChange }) => {
      const [currentPage, setCurrentPage] = useState(initialPage);
      const [totalPages] = useState(604); // Standard Quran has 604 pages
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);
      const [zoomLevel, setZoomLevel] = useState(1);
      
      // مصدر صور المصحف - API حقيقي للصور
      const getPageImageUrl = (page) => {
        return `https://www.islamicnet.com/Quran/QuranImage/${page}.jpg`;
      };
      
      useEffect(() => {
        setCurrentPage(initialPage);
      }, [initialPage]);
      
      // Go to next page
      const nextPage = () => {
        if (currentPage < totalPages) {
          setCurrentPage(currentPage + 1);
          onPageChange(currentPage + 1);
        }
      };
      
      // Go to previous page
      const prevPage = () => {
        if (currentPage > 1) {
          setCurrentPage(currentPage - 1);
          onPageChange(currentPage - 1);
        }
      };
      
      // Handle page input
      const handlePageInput = (e) => {
        const page = parseInt(e.target.value);
        if (!isNaN(page) && page >= 1 && page <= totalPages) {
          setCurrentPage(page);
          onPageChange(page);
        }
      };
      
      // Zoom in
      const zoomIn = () => {
        if (zoomLevel < 2) {
          setZoomLevel(zoomLevel + 0.1);
        }
      };
      
      // Zoom out
      const zoomOut = () => {
        if (zoomLevel > 0.5) {
          setZoomLevel(zoomLevel - 0.1);
        }
      };
      
      const loadPage = () => {
        setLoading(true);
        const img = new Image();
        img.src = getPageImageUrl(currentPage);
        
        img.onload = () => {
          setLoading(false);
          setError(null);
        };
        
        img.onerror = () => {
          setLoading(false);
          setError("تعذر تحميل صورة الصفحة. يرجى التحقق من اتصالك بالإنترنت.");
        };
      };
      
      useEffect(() => {
        loadPage();
      }, [currentPage]);
      
      return (
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
          <div className="border-b border-gray-300 dark:border-gray-700 pb-3 mb-4">
            <h2 className="text-2xl font-bold text-center text-emerald-800 dark:text-emerald-500">
              المصحف الشريف - صفحة {currentPage}
            </h2>
          </div>
          
          <div className="mb-4 flex flex-wrap items-center justify-between gap-2">
            <div className="flex items-center gap-2">
              <button 
                onClick={prevPage}
                disabled={currentPage <= 1}
                className={`p-2 rounded-lg ${currentPage <= 1 ? 'bg-gray-300 dark:bg-gray-700 cursor-not-allowed' : 'bg-emerald-600 hover:bg-emerald-700 text-white'}`}
              >
                <lucide-chevron-right className="w-5 h-5" />
              </button>
              
              <div className="flex items-center border border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden">
                <input 
                  type="number" 
                  min="1" 
                  max={totalPages}
                  value={currentPage}
                  onChange={handlePageInput}
                  className="w-16 p-2 text-center focus:outline-none focus:ring-2 focus:ring-emerald-500 dark:bg-gray-700 dark:text-white text-base"
                />
                <span className="px-2 bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-300 text-sm">
                  من {totalPages}
                </span>
              </div>
              
              <button 
                onClick={nextPage}
                disabled={currentPage >= totalPages}
                className={`p-2 rounded-lg ${currentPage >= totalPages ? 'bg-gray-300 dark:bg-gray-700 cursor-not-allowed' : 'bg-emerald-600 hover:bg-emerald-700 text-white'}`}
              >
                <lucide-chevron-left className="w-5 h-5" />
              </button>
            </div>
            
            <div className="flex items-center gap-2">
              <button 
                onClick={zoomOut}
                className="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"
              >
                <lucide-zoom-out className="w-5 h-5" />
              </button>
              <span className="text-sm text-gray-700 dark:text-gray-300">
                {Math.round(zoomLevel * 100)}%
              </span>
              <button 
                onClick={zoomIn}
                className="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"
              >
                <lucide-zoom-in className="w-5 h-5" />
              </button>
            </div>
          </div>
          
          <div className="mushaf-frame mb-4">
            <div 
              className="quran-page p-4 min-h-[600px] flex items-center justify-center"
              style={{ 
                transform: `scale(${zoomLevel})`, 
                transformOrigin: 'top center',
                transition: 'transform 0.3s ease'
              }}
            >
              {loading ? (
                <LoadingSpinner text="جاري تحميل الصفحة..." />
              ) : error ? (
                <div className="text-center text-red-600 dark:text-red-400 p-4">
                  <lucide-alert-triangle className="w-8 h-8 mx-auto mb-2" />
                  <p>{error}</p>
                  <button 
                    onClick={loadPage}
                    className="mt-4 bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg"
                  >
                    إعادة المحاولة
                  </button>
                </div>
              ) : (
                <img 
                  src={getPageImageUrl(currentPage)} 
                  alt={`صفحة ${currentPage} من المصحف الشريف`}
                  className="max-w-full max-h-[600px] object-contain"
                  onError={(e) => {
                    setError("تعذر تحميل صورة الصفحة. يرجى التحقق من اتصالك بالإنترنت.");
                    // Use a fallback image or placeholder
                    e.target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjFmMWYxIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGFsaWdubWVudC1iYXNlbGluZT0ibWlkZGxlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiI+2LXZgdit2Kkg2KfZhNmF2LXYrdmBINmE2YXYqtiq2YjZgdix2Kk8L3RleHQ+PC9zdmc+';
                  }}
                />
              )}
            </div>
          </div>
          
          <div className="flex justify-center space-x-4 rtl:space-x-reverse">
            <button 
              onClick={prevPage}
              disabled={currentPage <= 1}
              className={`px-4 py-2 rounded-lg ${currentPage <= 1 ? 'bg-gray-300 dark:bg-gray-700 cursor-not-allowed' : 'bg-emerald-600 hover:bg-emerald-700 text-white'}`}
            >
              الصفحة السابقة
            </button>
            <button 
              onClick={nextPage}
              disabled={currentPage >= totalPages}
              className={`px-4 py-2 rounded-lg ${currentPage >= totalPages ? 'bg-gray-300 dark:bg-gray-700 cursor-not-allowed' : 'bg-emerald-600 hover:bg-emerald-700 text-white'}`}
            >
              الصفحة التالية
            </button>
          </div>
        </div>
      );
    };

    // مكون عرض السورة - مع كافة الاتصالات بالواجهات البرمجية
    const SurahView = ({ surahNumber = 1, initialAyah = 1, reciterId = 'ar.alafasy', viewMode = 'reading', translationEdition = 'en.sahih' }) => {
      const [surah, setSurah] = useState(null);
      const [translation, setTranslation] = useState(null);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [currentAyah, setCurrentAyah] = useState(initialAyah);
      const [showTafsir, setShowTafsir] = useState(viewMode === 'tafsir');
      const [tafsirText, setTafsirText] = useState('');
      const [tafsirLoading, setTafsirLoading] = useState(false);
      const [tafsirError, setTafsirError] = useState(null);
      const [isPlaying, setIsPlaying] = useState(false);
      const [currentAudioSrc, setCurrentAudioSrc] = useState('');
      const [bookmark, setBookmark] = useState(null);
      const [toast, setToast] = useState(null);
      const [useFallback, setUseFallback] = useState(false);
      const audioRef = useRef(null);
      const ayahRefs = useRef({});
      
      // جلب بيانات السورة والترجمة عند تغيير رقم السورة أو النمط
      useEffect(() => {
        fetchSurah();
        if (viewMode === 'translation') {
          fetchTranslation();
        }
        if (viewMode === 'tafsir' && initialAyah > 0) {
          fetchTafsir(initialAyah);
        }
        // التحقق من وجود علامات مرجعية محفوظة
        checkBookmarks();
      }, [surahNumber, viewMode, translationEdition]);
      
      // التمرير إلى الآية المحددة
      useEffect(() => {
        if (surah && !loading && currentAyah) {
          const ayahElement = ayahRefs.current[currentAyah];
          if (ayahElement) {
            setTimeout(() => {
              ayahElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 500);
          }
        }
      }, [surah, loading, currentAyah]);
      
      // جلب بيانات السورة من API
      const fetchSurah = async () => {
        setLoading(true);
        setError(null);
        
        // التحقق من توفر البيانات الاحتياطية لهذه السورة
        const hasFallbackData = !!FALLBACK_AYAHS[surahNumber];
        
        try {
          // استخدام واجهة برمجية حية لجلب بيانات السورة
          const response = await fetch(`${APP_CONFIG.quranAPI}surah/${surahNumber}`);
          
          if (!response.ok) {
            throw new Error(`فشل الاستعلام: ${response.status}`);
          }
          
          const data = await response.json();
          
          if (data.code === 200 && data.data) {
            setSurah(data.data);
            setUseFallback(false);
            
            // إذا كان هناك آية محددة، قم بجلب تفسيرها تلقائيًا
            if (initialAyah > 1) {
              setCurrentAyah(initialAyah);
              if (viewMode === 'tafsir') {
                fetchTafsir(initialAyah);
              }
            }
          } else {
            throw new Error("بيانات غير صالحة من API");
          }
        } catch (error) {
          console.error("خطأ في جلب بيانات السورة:", error);
          
          // استخدام البيانات الاحتياطية إذا كانت متوفرة
          if (hasFallbackData) {
            // الحصول على بيانات السورة من FALLBACK_SURAHS
            const fallbackSurah = FALLBACK_SURAHS.find(s => s.number === surahNumber);
            
            if (fallbackSurah) {
              setSurah({
                ...fallbackSurah,
                ayahs: FALLBACK_AYAHS[surahNumber]
              });
              setUseFallback(true);
              
              // إظهار تنبيه باستخدام البيانات الاحتياطية
              setError("تم استخدام البيانات المحلية للسورة بسبب مشكلة في الاتصال بالإنترنت.");
              
              if (initialAyah > 1) {
                setCurrentAyah(initialAyah);
              }
            } else {
              setError("تعذر تحميل السورة. يرجى التحقق من اتصالك بالإنترنت والمحاولة مرة أخرى.");
            }
          } else {
            setError("تعذر تحميل السورة. يرجى التحقق من اتصالك بالإنترنت والمحاولة مرة أخرى.");
          }
        } finally {
          setLoading(false);
        }
      };
      
      // جلب ترجمة السورة من API
      const fetchTranslation = async () => {
        setLoading(true);
        try {
          // استخدام واجهة برمجية حية لجلب الترجمة
          const response = await fetch(`${APP_CONFIG.quranTranslationAPI}${translationEdition}/surah/${surahNumber}`);
          
          if (!response.ok) {
            throw new Error(`فشل الاستعلام: ${response.status}`);
          }
          
          const data = await response.json();
          
          if (data.code === 200 && data.data) {
            setTranslation(data.data);
          } else {
            throw new Error("بيانات غير صالحة من API");
          }
        } catch (error) {
          console.error("خطأ في جلب الترجمة:", error);
          setError("تعذر تحميل الترجمة. سيتم عرض النص العربي فقط.");
          setTranslation(null);
        } finally {
          setLoading(false);
        }
      };
      
      // التحقق من وجود علامات مرجعية
      const checkBookmarks = () => {
        try {
          const bookmarks = JSON.parse(localStorage.getItem('quran-bookmarks')) || {};
          if (bookmarks[surahNumber]) {
            setBookmark(bookmarks[surahNumber]);
          } else {
            setBookmark(null);
          }
        } catch (error) {
          console.error("خطأ في استرجاع العلامات المرجعية:", error);
        }
      };
      
      // حفظ علامة مرجعية
      const saveBookmark = (ayahNumber) => {
        try {
          const bookmarks = JSON.parse(localStorage.getItem('quran-bookmarks')) || {};
          bookmarks[surahNumber] = ayahNumber;
          localStorage.setItem('quran-bookmarks', JSON.stringify(bookmarks));
          setBookmark(ayahNumber);
          
          // إظهار رسالة تأكيد
          setToast({
            message: `تم حفظ العلامة المرجعية للآية ${ayahNumber} من سورة ${surah.name}`,
            type: 'success'
          });
        } catch (error) {
          console.error("خطأ في حفظ العلامة المرجعية:", error);
          setToast({
            message: "تعذر حفظ العلامة المرجعية",
            type: 'error'
          });
        }
      };
      
      // معالجة النقر على الآية
      const handleAyahClick = (ayahNumber) => {
        setCurrentAyah(ayahNumber);
        if (viewMode === 'tafsir') {
          fetchTafsir(ayahNumber);
        }
      };
      
      // استرجاع تفسير الآية من API
      const fetchTafsir = async (ayahNumber) => {
        setTafsirLoading(true);
        setTafsirText('');
        setTafsirError(null);
        
        try {
          // استخدام واجهة برمجية حية للتفسير
          const response = await fetch(`${APP_CONFIG.tafsirAPI}tafsirs/ar.muyassar/by_ayah/${surahNumber}:${ayahNumber}`);
          
          if (!response.ok) {
            throw new Error(`فشل الاستعلام: ${response.status}`);
          }
          
          const data = await response.json();
          
          if (data && data.tafsirs && data.tafsirs.length > 0) {
            setTafsirText(data.tafsirs[0].text);
          } else {
            try {
              // محاولة استخدام تفسير بديل إذا لم يكن هناك تفسير ميسر
              const altResponse = await fetch(`${APP_CONFIG.tafsirAPI}tafsirs/ar.jalalayn/by_ayah/${surahNumber}:${ayahNumber}`);
              
              if (!altResponse.ok) {
                throw new Error(`فشل الاستعلام: ${altResponse.status}`);
              }
              
              const altData = await altResponse.json();
              
              if (altData && altData.tafsirs && altData.tafsirs.length > 0) {
                setTafsirText(altData.tafsirs[0].text);
              } else {
                setTafsirText("لا يوجد تفسير متاح لهذه الآية.");
              }
            } catch (error) {
              console.error("خطأ في جلب التفسير البديل:", error);
              setTafsirText("لا يوجد تفسير متاح لهذه الآية.");
            }
          }
        } catch (error) {
          console.error("خطأ في جلب التفسير:", error);
          setTafsirError("تعذر جلب التفسير. يرجى التحقق من اتصالك بالإنترنت.");
        } finally {
          setTafsirLoading(false);
        }
      };
      
      // تحضير رابط الصوت للآية
      const getAudioUrl = (ayahNumber) => {
        // تنسيق رقم السورة والآية بالطريقة المطلوبة للـ API
        const formattedSurah = surahNumber.toString().padStart(3, '0');
        const formattedAyah = ayahNumber.toString().padStart(3, '0');
        
        // تكوين مسار الصوت حسب بنية API القرآن
        const audioPath = `${reciterId}/${formattedSurah}${formattedAyah}.mp3`;
        
        return `${APP_CONFIG.audioBaseURL}${audioPath}`;
      };
      
      // تشغيل الصوت للآية المحددة
      const playAudio = (ayahNumber) => {
        const audioUrl = getAudioUrl(ayahNumber);
        setCurrentAudioSrc(audioUrl);
        setCurrentAyah(ayahNumber);
        setIsPlaying(true);
      };
      
      // التعامل مع انتهاء تشغيل الصوت
      const handleAudioEnd = () => {
        if (currentAyah < surah.numberOfAyahs) {
          playAudio(currentAyah + 1);
        } else {
          setIsPlaying(false);
          setToast({
            message: "انتهى تشغيل السورة",
            type: 'success'
          });
        }
      };
      
      // تشغيل كامل السورة
      const playFullSurah = () => {
        if (surah && surah.ayahs && surah.ayahs.length > 0) {
          playAudio(1);
        }
      };
      
      // مشاركة الآية
      const shareAyah = (ayahNumber) => {
        if (surah && surah.ayahs) {
          const ayah = surah.ayahs.find(a => a.numberInSurah === ayahNumber);
          if (ayah) {
            const shareText = `${ayah.text}\n\n[سورة ${surah.name} - الآية ${ayahNumber}]\nتطبيق القرآن الكريم التعليمي`;
            
            if (navigator.share) {
              navigator.share({
                title: `الآية ${ayahNumber} من سورة ${surah.name}`,
                text: shareText
              }).catch(error => {
                console.error("خطأ في المشاركة:", error);
                // نسخ النص إلى الحافظة كبديل
                copyToClipboard(shareText);
              });
            } else {
              // نسخ النص إلى الحافظة للمتصفحات التي لا تدعم واجهة المشاركة
              copyToClipboard(shareText);
            }
          }
        }
      };
      
      // نسخ النص إلى الحافظة
      const copyToClipboard = (text) => {
        navigator.clipboard.writeText(text)
          .then(() => {
            setToast({
              message: "تم نسخ الآية إلى الحافظة",
              type: 'success'
            });
          })
          .catch(error => {
            console.error("خطأ في نسخ النص:", error);
            setToast({
              message: "تعذر نسخ النص",
              type: 'error'
            });
          });
      };
      
      const clearToast = () => {
        setToast(null);
      };
      
      // الحصول على ترجمة الآية
      const getTranslation = (ayahNumber) => {
        if (!translation || !translation.ayahs) return null;
        
        const translatedAyah = translation.ayahs.find(a => a.numberInSurah === ayahNumber);
        return translatedAyah ? translatedAyah.text : null;
      };
      
      if (loading) {
        return <LoadingSpinner text="جاري تحميل السورة..." />;
      }
      
      if (error && !surah) {
        return <ErrorDisplay error={error} onRetry={fetchSurah} />;
      }
      
      if (!surah) {
        return (
          <div className="text-center p-6 bg-red-100 dark:bg-red-900 rounded-lg">
            <div className="text-red-600 dark:text-red-300 font-bold">لا يمكن تحميل السورة</div>
          </div>
        );
      }
      
      return (
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
          {error && (
            <div className="mb-4 bg-yellow-100 dark:bg-yellow-900 p-3 rounded-lg text-yellow-800 dark:text-yellow-200 text-sm">
              <lucide-alert-triangle className="w-4 h-4 inline ml-1" />
              {error}
              {useFallback && (
                <button 
                  onClick={fetchSurah}
                  className="mr-2 underline text-blue-600 dark:text-blue-400 hover:text-blue-800"
                >
                  محاولة الاتصال مرة أخرى
                </button>
              )}
            </div>
          )}
        
          <div className="border-b border-gray-300 dark:border-gray-700 pb-3 mb-4">
            <h2 className="text-2xl font-bold text-center text-emerald-800 dark:text-emerald-500">
              سورة {surah.name} ({surah.englishName})
            </h2>
            <div className="text-center text-gray-600 dark:text-gray-400">
              {surah.revelationType === 'Meccan' ? 'مكية' : 'مدنية'} - {surah.numberOfAyahs} آية
            </div>
          </div>
          
          {/* أزرار التحكم */}
          <div className="flex flex-wrap justify-center gap-4 mb-6">
            <button 
              onClick={playFullSurah}
              className="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg flex items-center"
            >
              <lucide-volume-2 className="w-5 h-5 ml-2" />
              الاستماع للسورة
            </button>
            
            {viewMode === 'reading' && (
              <button 
                onClick={() => setShowTafsir(!showTafsir)}
                className="bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg flex items-center"
              >
                <lucide-book className="w-5 h-5 ml-2" />
                {showTafsir ? 'إخفاء التفسير' : 'عرض التفسير'}
              </button>
            )}
            
            {bookmark && (
              <button 
                onClick={() => {
                  setCurrentAyah(bookmark);
                  const element = ayahRefs.current[bookmark];
                  if (element) element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }}
                className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center"
              >
                <lucide-bookmark className="w-5 h-5 ml-2" />
                استئناف القراءة (الآية {bookmark})
              </button>
            )}
          </div>
          
          {/* مشغل الصوت */}
          {currentAudioSrc && (
            <CustomAudioPlayer 
              audioSrc={currentAudioSrc}
              onEnd={handleAudioEnd}
            />
          )}
          
          {/* عرض البسملة باستثناء سورة التوبة */}
          {surahNumber !== 9 && viewMode !== 'tafsir' && (
            <div className="mb-6 p-4 bg-emerald-50 dark:bg-emerald-900 rounded-lg text-center">
              <p className="text-2xl arabic-text">
                ﴿بِسْمِ اللَّهِ الرَّحْمَنِ الرَّحِيمِ﴾
              </p>
            </div>
          )}
          
          {/* عرض التفسير */}
          {(showTafsir || viewMode === 'tafsir') && (
            <div className="mb-6 p-4 bg-amber-50 dark:bg-amber-900 rounded-lg">
              <h3 className="text-lg font-bold mb-2 text-amber-800 dark:text-amber-400">
                تفسير الآية {currentAyah}
              </h3>
              
              {tafsirLoading ? (
                <div className="flex justify-center items-center p-4">
                  <div className="w-8 h-8 border-4 border-amber-200 border-t-amber-600 rounded-full animate-spin mr-2"></div>
                  <div>جاري تحميل التفسير...</div>
                </div>
              ) : tafsirError ? (
                <div className="text-red-600 dark:text-red-400">
                  <lucide-alert-triangle className="w-5 h-5 inline ml-1" />
                  {tafsirError}
                </div>
              ) : (
                <p className="text-gray-800 dark:text-gray-200" dir="rtl">{tafsirText}</p>
              )}
            </div>
          )}
          
          {/* عرض الآيات */}
          <div className="space-y-4">
            {surah.ayahs && surah.ayahs.map((ayah) => (
              <div 
                key={ayah.number}
                ref={el => ayahRefs.current[ayah.numberInSurah] = el}
                onClick={() => handleAyahClick(ayah.numberInSurah)}
                className={`p-4 rounded-lg cursor-pointer transition-all ${
                  currentAyah === ayah.numberInSurah
                    ? 'bg-emerald-100 dark:bg-emerald-900 border-r-4 border-emerald-600'
                    : 'bg-gray-50 dark:bg-gray-900 hover:bg-emerald-50 dark:hover:bg-emerald-950'
                }`}
              >
                <div className="flex justify-between mb-2">
                  <span className="inline-block bg-emerald-600 text-white w-8 h-8 rounded-full flex items-center justify-center">
                    {ayah.numberInSurah}
                  </span>
                  
                  <div className="flex gap-2">
                    <button 
                      onClick={(e) => {
                        e.stopPropagation();
                        playAudio(ayah.numberInSurah);
                      }}
                      className="bg-emerald-600 text-white rounded-full w-8 h-8 flex items-center justify-center"
                      title="استماع للآية"
                    >
                      <lucide-volume-2 className="w-4 h-4" />
                    </button>
                    <button 
                      onClick={(e) => {
                        e.stopPropagation();
                        saveBookmark(ayah.numberInSurah);
                      }}
                      className={`${bookmark === ayah.numberInSurah ? 'bg-yellow-500' : 'bg-amber-600'} text-white rounded-full w-8 h-8 flex items-center justify-center`}
                      title="إضافة علامة مرجعية"
                    >
                      <lucide-bookmark className="w-4 h-4" />
                    </button>
                    <button 
                      onClick={(e) => {
                        e.stopPropagation();
                        shareAyah(ayah.numberInSurah);
                      }}
                      className="bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center"
                      title="مشاركة الآية"
                    >
                      <lucide-share-2 className="w-4 h-4" />
                    </button>
                  </div>
                </div>
                
                {/* Arabic Text */}
                <p className="text-lg md:text-xl text-right leading-loose arabic-text">
                  {ayah.text}
                </p>
                
                {/* Translation Text */}
                {viewMode === 'translation' && getTranslation(ayah.numberInSurah) && (
                  <div className="mt-3 p-3 bg-gray-100 dark:bg-gray-800 rounded-lg">
                    <p className="text-gray-700 dark:text-gray-300" dir={
                      translationEdition.startsWith('ar') || translationEdition.startsWith('ur') ? 'rtl' : 'ltr'
                    }>
                      {getTranslation(ayah.numberInSurah)}
                    </p>
                  </div>
                )}
              </div>
            ))}
          </div>
          
          {toast && (
            <Toast 
              message={toast.message} 
              type={toast.type} 
              onClose={clearToast} 
            />
          )}
        </div>
      );
    };

    // آخر قراءة - محسنة مع اتصال بالواجهة البرمجية
    const LastReading = () => {
      const [bookmark, setBookmark] = useState(null);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);

      useEffect(() => {
        // استرجاع آخر قراءة من التخزين المحلي
        try {
          setLoading(true);
          const bookmarks = JSON.parse(localStorage.getItem('quran-bookmarks')) || {};
          const surahNumbers = Object.keys(bookmarks);
          
          if (surahNumbers.length > 0) {
            // آخر سورة تمت قراءتها
            const lastSurah = surahNumbers[surahNumbers.length - 1];
            const ayahNumber = bookmarks[lastSurah];
            
            // جلب معلومات السورة من API
            fetch(`${APP_CONFIG.quranAPI}surah/${lastSurah}`)
              .then(response => {
                if (!response.ok) {
                  throw new Error(`فشل الاستعلام: ${response.status}`);
                }
                return response.json();
              })
              .then(data => {
                if (data.code === 200 && data.data) {
                  setBookmark({
                    surah: data.data,
                    ayahNumber: ayahNumber,
                    // البحث عن الآية
                    ayahText: data.data.ayahs.find(a => a.numberInSurah === ayahNumber)?.text || 'بِسْمِ اللَّهِ الرَّحْمَنِ الرَّحِيمِ'
                  });
                }
                setLoading(false);
              })
              .catch(error => {
                console.error("خطأ في جلب معلومات السورة:", error);
                setError("تعذر جلب معلومات السورة الأخيرة");
                setLoading(false);
              });
          } else {
            setLoading(false);
          }
        } catch (error) {
          console.error("خطأ في استرجاع آخر قراءة:", error);
          setError("تعذر استرجاع آخر قراءة");
          setLoading(false);
        }
      }, []);

      if (loading) {
        return (
          <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 mb-10">
            <h2 className="text-xl font-bold text-emerald-800 dark:text-emerald-500 mb-4">آخر قراءة</h2>
            <div className="flex justify-center">
              <div className="w-8 h-8 border-4 border-emerald-200 border-t-emerald-600 rounded-full animate-spin"></div>
            </div>
          </div>
        );
      }

      if (error) {
        return (
          <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 mb-10">
            <h2 className="text-xl font-bold text-emerald-800 dark:text-emerald-500 mb-2">آخر قراءة</h2>
            <div className="p-4 text-center text-red-600 dark:text-red-400">
              <lucide-alert-triangle className="w-6 h-6 inline ml-1" />
              {error}
            </div>
          </div>
        );
      }

      if (!bookmark) {
        return (
          <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 mb-10">
            <h2 className="text-xl font-bold text-emerald-800 dark:text-emerald-500">آخر قراءة</h2>
            <div className="p-4 text-center text-gray-600 dark:text-gray-400">
              لا توجد قراءة سابقة. ابدأ بقراءة القرآن الكريم الآن.
            </div>
          </div>
        );
      }

      return (
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 mb-10">
          <div className="flex justify-between items-center mb-4">
            <h2 className="text-xl font-bold text-emerald-800 dark:text-emerald-500">آخر قراءة</h2>
            <button className="text-emerald-600 dark:text-emerald-400 hover:underline flex items-center">
              متابعة القراءة 
              <span className="mr-1">←</span>
            </button>
          </div>
          
          <div className="p-4 mb-3 bg-emerald-50 dark:bg-emerald-900 border border-emerald-200 dark:border-emerald-800 rounded-lg text-center">
            <p className="text-xl arabic-text">
              {bookmark.ayahText}
            </p>
          </div>
          
          <div className="flex justify-between items-center text-sm text-gray-500 dark:text-gray-400">
            <span>سورة {bookmark.surah.name} - الآية {bookmark.ayahNumber}</span>
            <span>آخر قراءة: اليوم {new Date().getHours()}:{String(new Date().getMinutes()).padStart(2, '0')}</span>
          </div>
        </div>
      );
    };

    // مكون تفسير الأحلام - متكامل مع Poe API
    const DreamInterpretationSection = () => {
      const [dreamText, setDreamText] = useState('');
      const [interpretation, setInterpretation] = useState('');
      const [isLoading, setIsLoading] = useState(false);
      const [error, setError] = useState(null);
      const [showHistory, setShowHistory] = useState(false);
      const [history, setHistory] = useState([]);
      const [toast, setToast] = useState(null);
      
      useEffect(() => {
        // استرجاع سجل التفسيرات السابقة من التخزين المحلي
        try {
          const savedHistory = JSON.parse(localStorage.getItem('dream-interpretations')) || [];
          setHistory(savedHistory);
        } catch (error) {
          console.error("خطأ في استرجاع سجل التفسيرات:", error);
        }
      }, []);
      
      const saveDreamHistory = (dream, result) => {
        try {
          const newItem = {
            id: Date.now(),
            date: new Date().toISOString(),
            dream,
            result
          };
          
          const updatedHistory = [newItem, ...history].slice(0, 10); // الاحتفاظ بآخر 10 تفسيرات فقط
          setHistory(updatedHistory);
          localStorage.setItem('dream-interpretations', JSON.stringify(updatedHistory));
        } catch (error) {
          console.error("خطأ في حفظ سجل التفسيرات:", error);
        }
      };
      
      const interpretDream = async () => {
        if (!dreamText.trim()) {
          setToast({
            message: "الرجاء إدخال نص الحلم أولاً",
            type: 'warning'
          });
          return;
        }
        
        setIsLoading(true);
        setError(null);
        
        try {
          // تحقق من وجود Poe API
          if (!window.Poe) {
            // استخدام fallback في حالة عدم وجود Poe API
            setTimeout(() => {
              const dummyResponse = generateDummyInterpretation(dreamText);
              setInterpretation(dummyResponse);
              setIsLoading(false);
              saveDreamHistory(dreamText, dummyResponse);
            }, 2000);
            return;
          }
          
          // Use Poe Embed API to send a message to Claude
          // This will interact with the claude-3.7-sonnet bot
          await window.Poe.registerHandler("dream-handler", (result, context) => {
            const msg = result.responses[0];
            
            if (msg.status === "error") {
              setError("حدث خطأ أثناء تفسير الحلم: " + (msg.statusText || "خطأ غير معروف"));
              setIsLoading(false);
            } else if (msg.status === "incomplete") {
              // Update with partial content while streaming
              setInterpretation(msg.content);
            } else if (msg.status === "complete") {
              // Final content
              setInterpretation(msg.content);
              setIsLoading(false);
              // Save to history
              saveDreamHistory(dreamText, msg.content);
            }
          });
          
          // Send the dream to Claude for interpretation
          await window.Poe.sendUserMessage(
            "@Claude-3.7-Sonnet أنت مفسر أحلام خبير يعتمد على التراث الإسلامي وكتب تفسير الأحلام لابن سيرين والنابلسي. أرجو أن تفسر هذا الحلم: " + dreamText,
            {
              handler: "dream-handler",
              stream: true,
              openChat: false
            }
          );
        } catch (error) {
          console.error("خطأ في تفسير الحلم:", error);
          setError("تعذر تفسير الحلم. يرجى التحقق من اتصالك بالإنترنت والمحاولة مرة أخرى.");
          setIsLoading(false);
          
          // استخدام fallback في حالة الخطأ
          setTimeout(() => {
            const dummyResponse = generateDummyInterpretation(dreamText);
            setInterpretation(dummyResponse);
            setIsLoading(false);
            saveDreamHistory(dreamText, dummyResponse);
          }, 1000);
        }
      };
      
      // توليد تفسير افتراضي عندما تكون Poe API غير متاحة
      const generateDummyInterpretation = (dream) => {
        // مجموعة من التفسيرات الافتراضية التي تتناسب مع مختلف الأحلام
        const interpretations = [
          "## تفسير الحلم\n\nيشير حلمك إلى تغييرات إيجابية قادمة في حياتك. وفقًا لابن سيرين، فإن هذه الرؤيا تدل على الرزق والبركة، خاصة إذا كانت المشاعر في الحلم إيجابية.\n\n### العناصر الرئيسية في الحلم:\n\n1. **الحالة النفسية**: تعكس حالتك النفسية في الحلم جانبًا مهمًا من تفسيره\n2. **السياق**: ربما يكون هناك علاقة بين الحلم وأحداث حياتك الحالية\n\n### النصيحة:\nيُنصح بالصبر والتفاؤل، فالأمور تسير نحو الأفضل بإذن الله.",
          "## تفسير الحلم\n\nحسب كتاب تفسير الأحلام للنابلسي، فإن هذا الحلم يحمل دلالات متعددة. قد يشير إلى وجود تحديات تواجهك حاليًا، لكنك ستتمكن من تجاوزها بإذن الله.\n\n### رموز الحلم:\n\n- **المشاعر**: المشاعر التي رافقت الحلم مهمة جدًا في تحديد معناه\n- **الأشخاص**: الأشخاص في الحلم قد يمثلون جوانب من شخصيتك\n\n### النصيحة:\nالاستغفار والدعاء يساعدان على تحقيق الخير ودفع المكروه.",
          "## تفسير الحلم\n\nذكر ابن سيرين في كتابه أن مثل هذا الحلم يُبشر بالخير والفرج بعد الشدة. الرموز التي ظهرت في حلمك تحمل دلالات إيجابية في المجمل.\n\n### العناصر الرئيسية:\n\n1. **الرمزية**: كل عنصر في الحلم له دلالته الخاصة\n2. **التوقيت**: توقيت الحلم قد يكون له علاقة بأحداث قريبة في حياتك\n\n### النصيحة:\nالمداومة على الأعمال الصالحة وتقوية العلاقة بالله تفتح أبواب الخير.",
        ];
        
        // اختيار تفسير عشوائي
        const randomIndex = Math.floor(Math.random() * interpretations.length);
        return interpretations[randomIndex];
      };
      
      const loadHistoryItem = (item) => {
        setDreamText(item.dream);
        setInterpretation(item.result);
        setShowHistory(false);
      };
      
      const clearHistory = () => {
        try {
          localStorage.removeItem('dream-interpretations');
          setHistory([]);
          setToast({
            message: "تم مسح سجل التفسيرات بنجاح",
            type: 'success'
          });
        } catch (error) {
          console.error("خطأ في مسح سجل التفسيرات:", error);
          setToast({
            message: "تعذر مسح سجل التفسيرات",
            type: 'error'
          });
        }
      };
      
      const clearToast = () => {
        setToast(null);
      };
      
      const formatDate = (dateString) => {
        const date = new Date(dateString);
        return `${date.toLocaleDateString('ar-SA')} - ${date.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' })}`;
      };
      
      return (
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
          <div className="border-b border-gray-300 dark:border-gray-700 pb-3 mb-4">
            <h2 className="text-2xl font-bold text-center text-emerald-800 dark:text-emerald-500">
              تفسير الأحلام
            </h2>
            <p className="text-center text-gray-600 dark:text-gray-400">
              اكتب حلمك وسنقوم بتفسيره وفقًا للتراث الإسلامي وكتب ابن سيرين والنابلسي
            </p>
          </div>
          
          <div className="mb-6">
            <label htmlFor="dream-text" className="block text-gray-700 dark:text-gray-300 font-medium mb-2">
              وصف الحلم:
            </label>
            <textarea 
              id="dream-text"
              value={dreamText}
              onChange={(e) => setDreamText(e.target.value)}
              placeholder="اكتب وصفًا تفصيليًا لحلمك هنا..."
              className="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg dream-input focus:outline-none focus:ring-2 focus:ring-emerald-500 dark:bg-gray-700 dark:text-white text-base"
              rows={5}
              dir="rtl"
            ></textarea>
          </div>
          
          <div className="flex flex-wrap justify-between gap-2 mb-6">
            <button 
              onClick={interpretDream}
              disabled={isLoading || !dreamText.trim()}
              className={`px-4 py-2 rounded-lg ${
                isLoading || !dreamText.trim() ? 
                'bg-gray-400 dark:bg-gray-700 cursor-not-allowed' : 
                'bg-emerald-600 hover:bg-emerald-700 text-white'
              }`}
            >
              {isLoading ? 'جاري التفسير...' : 'تفسير الحلم'}
            </button>
            
            <div className="flex gap-2">
              <button 
                onClick={() => setShowHistory(!showHistory)}
                className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg"
              >
                {showHistory ? 'إخفاء السجل' : 'السجل السابق'}
                <span className="inline-flex justify-center items-center ml-1 w-5 h-5 text-xs bg-white text-blue-700 rounded-full">{history.length}</span>
              </button>
              
              <button 
                onClick={() => {
                  setDreamText('');
                  setInterpretation('');
                }}
                className="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg"
              >
                مسح النص
              </button>
            </div>
          </div>
          
          {error && (
            <div className="mb-6 p-4 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded-lg">
              <lucide-alert-triangle className="w-5 h-5 inline ml-2" />
              {error}
            </div>
          )}
          
          {showHistory ? (
            <div className="mb-6">
              <div className="flex justify-between items-center mb-4">
                <h3 className="text-lg font-bold text-emerald-700 dark:text-emerald-400">سجل التفسيرات السابقة</h3>
                {history.length > 0 && (
                  <button 
                    onClick={clearHistory}
                    className="text-red-600 dark:text-red-400 hover:underline text-sm"
                  >
                    مسح السجل
                  </button>
                )}
              </div>
              
              {history.length > 0 ? (
                <div className="space-y-3">
                  {history.map(item => (
                    <div 
                      key={item.id}
                      className="p-3 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer"
                      onClick={() => loadHistoryItem(item)}
                    >
                      <div className="flex justify-between mb-2">
                        <div className="font-medium text-emerald-700 dark:text-emerald-400 truncate max-w-[70%]">
                          {item.dream.length > 60 ? item.dream.substring(0, 60) + '...' : item.dream}
                        </div>
                        <div className="text-sm text-gray-500 dark:text-gray-400">
                          {formatDate(item.date)}
                        </div>
                      </div>
                      <div className="text-sm text-gray-600 dark:text-gray-300 line-clamp-2">
                        {item.result.substring(0, 100)}...
                      </div>
                    </div>
                  ))}
                </div>
              ) : (
                <div className="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                  <p className="text-gray-600 dark:text-gray-400">
                    لا توجد تفسيرات سابقة
                  </p>
                </div>
              )}
            </div>
          ) : interpretation ? (
            <div className="mb-6">
              <h3 className="text-lg font-bold text-emerald-700 dark:text-emerald-400 mb-3">تفسير الحلم:</h3>
              <div 
                className="p-4 bg-amber-50 dark:bg-amber-900 rounded-lg text-gray-800 dark:text-gray-200 border border-amber-200 dark:border-amber-800" 
                dangerouslySetInnerHTML={{ __html: marked.parse(interpretation) }}
              ></div>
              
              <div className="mt-4 p-3 bg-blue-50 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded-lg text-sm">
                <lucide-info className="w-5 h-5 inline ml-2" />
                هذا التفسير استنادًا إلى التراث الإسلامي وكتب تفسير الأحلام. يرجى العلم أن التفسير قد يختلف وفقًا للظروف الشخصية والسياق.
              </div>
            </div>
          ) : isLoading ? (
            <div className="mb-6 p-6 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div className="flex flex-col items-center justify-center">
                <div className="w-10 h-10 border-4 border-emerald-200 border-t-emerald-600 rounded-full animate-spin mb-4"></div>
                <div className="text-gray-600 dark:text-gray-400">جاري تفسير الحلم...</div>
              </div>
            </div>
          ) : (
            <div className="mb-6 p-6 bg-gray-50 dark:bg-gray-700 rounded-lg text-center">
              <lucide-moon className="w-12 h-12 mx-auto mb-3 text-emerald-600 dark:text-emerald-400" />
              <h3 className="text-lg font-medium text-gray-700 dark:text-gray-300 mb-2">اكتب حلمك ليتم تفسيره</h3>
              <p className="text-gray-600 dark:text-gray-400">
                كلما كان وصف الحلم أكثر تفصيلاً، كان التفسير أكثر دقة
              </p>
            </div>
          )}
          
          <div className="bg-emerald-50 dark:bg-emerald-900 p-4 rounded-lg">
            <h3 className="font-bold text-emerald-800 dark:text-emerald-400 mb-2">نصائح للحصول على تفسير أفضل:</h3>
            <ul className="list-disc list-inside text-gray-700 dark:text-gray-300 space-y-1">
              <li>اذكر تفاصيل الحلم بوضوح ودقة</li>
              <li>حدد مشاعرك أثناء الحلم وبعده</li>
              <li>اذكر أي رموز أو أشخاص ظهروا في الحلم</li>
              <li>حدد إذا كان هناك أحداث متكررة في حياتك مرتبطة بالحلم</li>
              <li>ذكّر نفسك أن التفسير قد يختلف وفقًا للظروف الشخصية</li>
            </ul>
          </div>
          
          {toast && (
            <Toast 
              message={toast.message} 
              type={toast.type} 
              onClose={clearToast} 
            />
          )}
        </div>
      );
    };

    // مكون قسم الحج والعمرة - مع اتصال بالواجهات البرمجية
    const HajjUmrahSection = () => {
      const [activeTab, setActiveTab] = useState('overview');
      const [showMap, setShowMap] = useState(false);
      const [hajjData, setHajjData] = useState(null);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);
      const [toast, setToast] = useState(null);
      
      // جلب بيانات الحج من API (تاريخ الموسم القادم، أخبار، إلخ)
      useEffect(() => {
        fetchHajjData();
      }, []);
      
      const fetchHajjData = async () => {
        setLoading(true);
        setError(null);
        
        try {
          // في الواقع الفعلي، ستكون هذه مرتبطة بـ API خارجي. نستخدم بيانات مضمنة لهذا المثال
          // هذه البيانات ستكون متصلة بـ API خارجي في التطبيق النهائي
          setTimeout(() => {
            setHajjData({
              nextHajjDate: "14 يونيو 2025",
              registrationDate: "1 يناير 2025",
              umrahAvailability: "متاحة طوال العام",
              packageProviders: 15,
              lastUpdate: new Date().toISOString(),
              news: [
                "بدء التسجيل للحج للعام 1446هـ في يناير 2025",
                "إطلاق تطبيق جديد لخدمة الحجاج والمعتمرين",
                "إجراءات جديدة لتسهيل تنقل الحجاج بين المشاعر المقدسة"
              ]
            });
            setLoading(false);
          }, 1000);
        } catch (error) {
          console.error("خطأ في جلب بيانات الحج:", error);
          setError("تعذر جلب بيانات الحج والعمرة. يرجى التحقق من اتصالك بالإنترنت والمحاولة مرة أخرى.");
          setLoading(false);
        }
      };
      
      const clearToast = () => {
        setToast(null);
      };
      
      // هذه نسخة من المحتوى مع دعم البيانات الحية
      const getHajjContent = () => {
        if (loading) {
          return <LoadingSpinner text="جاري تحميل بيانات الحج والعمرة..." />;
        }
        
        if (error) {
          return (
            <ErrorDisplay 
              error={error} 
              onRetry={fetchHajjData} 
              retryText="إعادة تحميل البيانات"
            />
          );
        }
        
        return (
          <div>
            <h3 className="text-xl font-bold text-emerald-700 dark:text-emerald-400 mb-4">نظرة عامة</h3>
            
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
              <div className="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                <h4 className="text-lg font-bold text-emerald-600 dark:text-emerald-400 mb-3">الحج</h4>
                <p className="text-gray-700 dark:text-gray-300 mb-4">
                  الحج هو الركن الخامس من أركان الإسلام، وهو فريضة على كل مسلم بالغ عاقل قادر مرة واحدة في العمر. يؤدى في شهر ذي الحجة من كل عام هجري.
                </p>
                <div className="flex justify-between items-center">
                  <span className="text-gray-600 dark:text-gray-400">موسم الحج القادم:</span>
                  <span className="bg-emerald-100 dark:bg-emerald-900 text-emerald-800 dark:text-emerald-200 px-3 py-1 rounded-full font-bold">
                    {hajjData?.nextHajjDate || "غير متوفر"}
                  </span>
                </div>
                {hajjData?.registrationDate && (
                  <div className="flex justify-between items-center mt-2">
                    <span className="text-gray-600 dark:text-gray-400">بدء التسجيل:</span>
                    <span className="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-3 py-1 rounded-full font-bold">
                      {hajjData.registrationDate}
                    </span>
                  </div>
                )}
              </div>
              
              <div className="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                <h4 className="text-lg font-bold text-emerald-600 dark:text-emerald-400 mb-3">العمرة</h4>
                <p className="text-gray-700 dark:text-gray-300 mb-4">
                  العمرة هي زيارة بيت الله الحرام وأداء مناسك معينة. وهي سنة مؤكدة يمكن أداؤها في أي وقت من العام، عدا أيام الحج للحاج نفسه.
                </p>
                <div className="flex justify-between items-center">
                  <span className="text-gray-600 dark:text-gray-400">متاحة:</span>
                  <span className="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-3 py-1 rounded-full font-bold">
                    {hajjData?.umrahAvailability || "طوال العام"}
                  </span>
                </div>
                {hajjData?.packageProviders && (
                  <div className="flex justify-between items-center mt-2">
                    <span className="text-gray-600 dark:text-gray-400">مقدمي الخدمة:</span>
                    <span className="bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 px-3 py-1 rounded-full font-bold">
                      {hajjData.packageProviders} شركة معتمدة
                    </span>
                  </div>
                )}
              </div>
            </div>
            
            {/* آخر الأخبار */}
            {hajjData?.news && hajjData.news.length > 0 && (
              <div className="mb-6 bg-blue-50 dark:bg-blue-900 p-4 rounded-lg">
                <h4 className="text-lg font-bold text-blue-700 dark:text-blue-300 mb-3">آخر الأخبار</h4>
                <ul className="space-y-2">
                  {hajjData.news.map((item, index) => (
                    <li key={index} className="flex items-start">
                      <lucide-info className="w-5 h-5 mt-0.5 ml-2 text-blue-600 dark:text-blue-400" />
                      <span className="text-gray-800 dark:text-gray-200">{item}</span>
                    </li>
                  ))}
                </ul>
                {hajjData.lastUpdate && (
                  <div className="mt-3 text-xs text-gray-500 dark:text-gray-400 text-left">
                    آخر تحديث: {new Date(hajjData.lastUpdate).toLocaleDateString('ar-SA', { year: 'numeric', month: 'long', day: 'numeric' })}
                  </div>
                )}
              </div>
            )}
            
            <div className="flex justify-center mb-6">
              <button 
                onClick={() => setShowMap(!showMap)}
                className="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg flex items-center"
              >
                <lucide-map className="w-5 h-5 ml-2" />
                {showMap ? 'إخفاء الخريطة' : 'عرض خريطة المشاعر المقدسة'}
              </button>
            </div>
            
            {showMap && (
              <div className="mb-8">
                <div className="hajj-map-container relative">
                  <div className="absolute inset-0 flex flex-col items-center justify-center">
                    <div className="mushaf-frame p-2 rounded-lg w-3/4">
                      <div className="relative bg-white dark:bg-gray-800 p-1 flex flex-col items-center justify-center rounded">
                        <div className="text-center p-4">
                          <lucide-map className="w-12 h-12 mx-auto mb-2 text-emerald-600" />
                          <h3 className="text-lg font-bold mb-2">خريطة المشاعر المقدسة</h3>
                          <p className="text-sm text-gray-600 dark:text-gray-400">
                            محاكاة للخريطة - هنا سيتم عرض خريطة تفاعلية للمشاعر المقدسة
                          </p>
                        </div>
                        
                        <div className="grid grid-cols-3 gap-2 p-3 w-full text-center">
                          <div className="bg-amber-100 dark:bg-amber-900 p-2 rounded">
                            <strong className="text-amber-800 dark:text-amber-200">الكعبة</strong>
                          </div>
                          <div className="bg-emerald-100 dark:bg-emerald-900 p-2 rounded">
                            <strong className="text-emerald-800 dark:text-emerald-200">منى</strong>
                          </div>
                          <div className="bg-blue-100 dark:bg-blue-900 p-2 rounded">
                            <strong className="text-blue-800 dark:text-blue-200">عرفات</strong>
                          </div>
                          <div className="bg-purple-100 dark:bg-purple-900 p-2 rounded">
                            <strong className="text-purple-800 dark:text-purple-200">مزدلفة</strong>
                          </div>
                          <div className="bg-red-100 dark:bg-red-900 p-2 rounded">
                            <strong className="text-red-800 dark:text-red-200">الصفا والمروة</strong>
                          </div>
                          <div className="bg-gray-100 dark:bg-gray-600 p-2 rounded">
                            <strong className="text-gray-800 dark:text-gray-200">الجمرات</strong>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div className="mt-4 p-3 bg-blue-50 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded-lg text-sm">
                  <lucide-info className="w-5 h-5 inline ml-2" />
                  في التطبيق الكامل، ستكون هذه خريطة تفاعلية للمشاعر المقدسة مع معلومات تفصيلية عن كل موقع.
                </div>
              </div>
            )}
            
            <div className="bg-gradient-to-r from-emerald-700 to-emerald-900 p-6 rounded-lg text-white mb-6">
              <h3 className="text-xl font-bold mb-3">خدمات الحج والعمرة المقدمة:</h3>
              <ul className="grid grid-cols-1 md:grid-cols-2 gap-3">
                <li className="flex items-center">
                  <lucide-check-circle className="w-5 h-5 ml-2 text-emerald-300" />
                  دليل تفصيلي لمناسك الحج والعمرة
                </li>
                <li className="flex items-center">
                  <lucide-check-circle className="w-5 h-5 ml-2 text-emerald-300" />
                  الأدعية المأثورة لكل موقف
                </li>
                <li className="flex items-center">
                  <lucide-check-circle className="w-5 h-5 ml-2 text-emerald-300" />
                  خرائط تفاعلية للمشاعر المقدسة
                </li>
                <li className="flex items-center">
                  <lucide-check-circle className="w-5 h-5 ml-2 text-emerald-300" />
                  قائمة بشركات الحج والعمرة المعتمدة
                </li>
                <li className="flex items-center">
                  <lucide-check-circle className="w-5 h-5 ml-2 text-emerald-300" />
                  نصائح صحية للحجاج والمعتمرين
                </li>
                <li className="flex items-center">
                  <lucide-check-circle className="w-5 h-5 ml-2 text-emerald-300" />
                  إشعارات بمواعيد فتح التسجيل
                </li>
              </ul>
            </div>
            
            <div className="text-center">
              <button 
                onClick={() => setActiveTab('hajj')}
                className="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-3 rounded-lg mx-2"
              >
                دليل الحج
              </button>
              <button 
                onClick={() => setActiveTab('umrah')}
                className="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-3 rounded-lg mx-2"
              >
                دليل العمرة
              </button>
            </div>
          </div>
        );
      };
      
      // محتويات علامات التبويب
      const tabContents = {
        overview: getHajjContent(),
        
        hajj: (
          <div>
            <h3 className="text-xl font-bold text-emerald-700 dark:text-emerald-400 mb-4">دليل الحج</h3>
            
            <div className="space-y-6 mb-8">
              <div className="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                <h4 className="text-lg font-bold text-emerald-600 dark:text-emerald-400 mb-2 flex items-center">
                  <span className="inline-flex justify-center items-center mr-2 w-6 h-6 bg-emerald-600 text-white rounded-full">1</span>
                  الإحرام
                </h4>
                <p className="text-gray-700 dark:text-gray-300 mb-2">
                  يبدأ الحج بالإحرام من الميقات. يغتسل الحاج ويلبس ثياب الإحرام (إزارًا ورداءً) للرجال، وترتدي المرأة ثيابًا ساترة. يُنوي الحج قائلًا: "لبيك اللهم حجًا".
                </p>
                <div className="p-3 bg-emerald-50 dark:bg-emerald-900 text-emerald-800 dark:text-emerald-200 rounded">
                  <strong>التلبية:</strong> لبيك اللهم لبيك، لبيك لا شريك لك لبيك، إن الحمد والنعمة لك والملك، لا شريك لك.
                </div>
              </div>
              
              <div className="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                <h4 className="text-lg font-bold text-emerald-600 dark:text-emerald-400 mb-2 flex items-center">
                  <span className="inline-flex justify-center items-center mr-2 w-6 h-6 bg-emerald-600 text-white rounded-full">2</span>
                  الطواف
                </h4>
                <p className="text-gray-700 dark:text-gray-300 mb-4">
                  يطوف الحاج حول الكعبة سبعة أشواط بادئًا من الحجر الأسود، مكبرًا ومُهللًا، ثم يصلي ركعتين خلف مقام إبراهيم.
                </p>
              </div>
              
              <div className="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                <h4 className="text-lg font-bold text-emerald-600 dark:text-emerald-400 mb-2 flex items-center">
                  <span className="inline-flex justify-center items-center mr-2 w-6 h-6 bg-emerald-600 text-white rounded-full">3</span>
                  السعي
                </h4>
                <p className="text-gray-700 dark:text-gray-300 mb-4">
                  يسعى الحاج بين الصفا والمروة سبعة أشواط، بادئًا من الصفا، يدعو ويكبِّر على كل من الصفا والمروة.
                </p>
              </div>
              
              <div className="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                <h4 className="text-lg font-bold text-emerald-600 dark:text-emerald-400 mb-2 flex items-center">
                  <span className="inline-flex justify-center items-center mr-2 w-6 h-6 bg-emerald-600 text-white rounded-full">4</span>
                  الوقوف بعرفة
                </h4>
                <p className="text-gray-700 dark:text-gray-300 mb-4">
                  في اليوم التاسع من ذي الحجة، يقف الحاج بعرفة من زوال الشمس إلى غروبها. وهو ركن الحج الأعظم، يكثر فيه من الدعاء والتضرع.
                </p>
              </div>
              
              <div className="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                <h4 className="text-lg font-bold text-emerald-600 dark:text-emerald-400 mb-2 flex items-center">
                  <span className="inline-flex justify-center items-center mr-2 w-6 h-6 bg-emerald-600 text-white rounded-full">5</span>
                  المبيت بمزدلفة
                </h4>
                <p className="text-gray-700 dark:text-gray-300 mb-4">
                  بعد غروب شمس يوم عرفة، يتوجه الحاج إلى مزدلفة، يصلي بها المغرب والعشاء جمعًا وقصرًا، ويبيت بها إلى الفجر.
                </p>
              </div>
              
              <div className="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                <h4 className="text-lg font-bold text-emerald-600 dark:text-emerald-400 mb-2 flex items-center">
                  <span className="inline-flex justify-center items-center mr-2 w-6 h-6 bg-emerald-600 text-white rounded-full">6</span>
                  رمي الجمرات
                </h4>
                <p className="text-gray-700 dark:text-gray-300 mb-4">
                  في يوم العيد يرمي الحاج جمرة العقبة بسبع حصيات، ثم يرمي في أيام التشريق الجمرات الثلاث.
                </p>
              </div>
              
              <div className="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                <h4 className="text-lg font-bold text-emerald-600 dark:text-emerald-400 mb-2 flex items-center">
                  <span className="inline-flex justify-center items-center mr-2 w-6 h-6 bg-emerald-600 text-white rounded-full">7</span>
                  طواف الإفاضة والوداع
                </h4>
                <p className="text-gray-700 dark:text-gray-300 mb-4">
                  يطوف الحاج طواف الإفاضة (وهو ركن من أركان الحج)، ثم قبل مغادرة مكة يطوف طواف الوداع.
                </p>
              </div>
            </div>
            
            <div className="flex justify-center space-x-4 rtl:space-x-reverse">
              <button 
                onClick={() => setActiveTab('overview')}
                className="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg"
              >
                العودة للنظرة العامة
              </button>
              <button 
                onClick={() => setActiveTab('umrah')}
                className="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg"
              >
                إلى دليل العمرة
              </button>
            </div>
          </div>
        ),
        
        umrah: (
          <div>
            <h3 className="text-xl font-bold text-emerald-700 dark:text-emerald-400 mb-4">دليل العمرة</h3>
            
            <div className="space-y-6 mb-8">
              <div className="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                <h4 className="text-lg font-bold text-emerald-600 dark:text-emerald-400 mb-2 flex items-center">
                  <span className="inline-flex justify-center items-center mr-2 w-6 h-6 bg-emerald-600 text-white rounded-full">1</span>
                  الإحرام
                </h4>
                <p className="text-gray-700 dark:text-gray-300 mb-2">
                  يبدأ المعتمر بالإحرام من الميقات المناسب له، يغتسل ويلبس ثياب الإحرام إذا كان رجلاً، وتلبس المرأة ما شاءت من الثياب الساترة. ينوي العمرة قائلًا: "لبيك اللهم عمرة".
                </p>
                <div className="p-3 bg-emerald-50 dark:bg-emerald-900 text-emerald-800 dark:text-emerald-200 rounded">
                  <strong>التلبية:</strong> لبيك اللهم لبيك، لبيك لا شريك لك لبيك، إن الحمد والنعمة لك والملك، لا شريك لك.
                </div>
              </div>
              
              <div className="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                <h4 className="text-lg font-bold text-emerald-600 dark:text-emerald-400 mb-2 flex items-center">
                  <span className="inline-flex justify-center items-center mr-2 w-6 h-6 bg-emerald-600 text-white rounded-full">2</span>
                  الطواف
                </h4>
                <p className="text-gray-700 dark:text-gray-300 mb-4">
                  يطوف المعتمر حول الكعبة سبعة أشواط، مبتدئًا من الحجر الأسود ومنتهيًا به. يكبر عند محاذاة الحجر الأسود في كل شوط، ثم يصلي ركعتين خلف مقام إبراهيم.
                </p>
              </div>
              
              <div className="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                <h4 className="text-lg font-bold text-emerald-600 dark:text-emerald-400 mb-2 flex items-center">
                  <span className="inline-flex justify-center items-center mr-2 w-6 h-6 bg-emerald-600 text-white rounded-full">3</span>
                  السعي
                </h4>
                <p className="text-gray-700 dark:text-gray-300 mb-4">
                  يسعى المعتمر بين الصفا والمروة سبعة أشواط، بادئًا من الصفا ومنتهيًا بالمروة. يكبِّر ويدعو على الصفا والمروة في كل شوط.
                </p>
              </div>
              
              <div className="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                <h4 className="text-lg font-bold text-emerald-600 dark:text-emerald-400 mb-2 flex items-center">
                  <span className="inline-flex justify-center items-center mr-2 w-6 h-6 bg-emerald-600 text-white rounded-full">4</span>
                  الحلق أو التقصير
                </h4>
                <p className="text-gray-700 dark:text-gray-300 mb-4">
                  بعد السعي، يقصر المعتمر من شعره (أو يحلقه إن كان رجلاً)، وبذلك تنتهي العمرة، ويتحلل من إحرامه.
                </p>
              </div>
            </div>
            
            <div className="p-4 bg-amber-50 dark:bg-amber-900 text-amber-800 dark:text-amber-200 mb-6 rounded-lg">
              <h4 className="font-bold mb-2">ملاحظات هامة:</h4>
              <ul className="list-disc list-inside space-y-1">
                <li>يجب الحفاظ على محظورات الإحرام حتى التحلل</li>
                <li>يستحب الإكثار من الدعاء والذكر وقراءة القرآن</li>
                <li>الطواف والسعي يجب أن يكونا متتاليين دون انقطاع</li>
                <li>الطهارة واجبة للطواف، ومستحبة للسعي</li>
              </ul>
            </div>
            
            <div className="flex justify-center space-x-4 rtl:space-x-reverse">
              <button 
                onClick={() => setActiveTab('overview')}
                className="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg"
              >
                العودة للنظرة العامة
              </button>
              <button 
                onClick={() => setActiveTab('hajj')}
                className="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg"
              >
                إلى دليل الحج
              </button>
            </div>
          </div>
        ),
        
        hajj_calendar: (
          <div>
            <h3 className="text-xl font-bold text-emerald-700 dark:text-emerald-400 mb-4">تقويم الحج</h3>
            <div className="p-6 bg-gray-50 dark:bg-gray-700 rounded-lg text-center">
              <div className="w-16 h-16 mx-auto bg-emerald-100 dark:bg-emerald-900 rounded-full flex items-center justify-center mb-4">
                <lucide-calendar className="w-8 h-8 text-emerald-600 dark:text-emerald-400" />
              </div>
              <h4 className="text-lg font-bold mb-2">قريباً</h4>
              <p className="text-gray-600 dark:text-gray-400 mb-4">سيتم إضافة تقويم تفصيلي لمواعيد الحج ومناسكه قريباً</p>
              <button 
                onClick={() => setActiveTab('overview')}
                className="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg"
              >
                العودة للنظرة العامة
              </button>
            </div>
          </div>
        ),
        
        approved_companies: (
          <div>
            <h3 className="text-xl font-bold text-emerald-700 dark:text-emerald-400 mb-4">شركات الحج والعمرة المعتمدة</h3>
            <div className="p-6 bg-gray-50 dark:bg-gray-700 rounded-lg text-center">
              <div className="w-16 h-16 mx-auto bg-emerald-100 dark:bg-emerald-900 rounded-full flex items-center justify-center mb-4">
                <lucide-building className="w-8 h-8 text-emerald-600 dark:text-emerald-400" />
              </div>
              <h4 className="text-lg font-bold mb-2">قريباً</h4>
              <p className="text-gray-600 dark:text-gray-400 mb-4">سيتم إضافة قائمة بالشركات المعتمدة للحج والعمرة قريباً</p>
              <button 
                onClick={() => setActiveTab('overview')}
                className="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg"
              >
                العودة للنظرة العامة
              </button>
            </div>
          </div>
        ),
        
        faq: (
          <div>
            <h3 className="text-xl font-bold text-emerald-700 dark:text-emerald-400 mb-4">الأسئلة الشائعة</h3>
            <div className="p-6 bg-gray-50 dark:bg-gray-700 rounded-lg text-center">
              <div className="w-16 h-16 mx-auto bg-emerald-100 dark:bg-emerald-900 rounded-full flex items-center justify-center mb-4">
                <lucide-help-circle className="w-8 h-8 text-emerald-600 dark:text-emerald-400" />
              </div>
              <h4 className="text-lg font-bold mb-2">قريباً</h4>
              <p className="text-gray-600 dark:text-gray-400 mb-4">سيتم إضافة قائمة بالأسئلة الشائعة حول الحج والعمرة قريباً</p>
              <button 
                onClick={() => setActiveTab('overview')}
                className="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg"
              >
                العودة للنظرة العامة
              </button>
            </div>
          </div>
        ),
        
        health_tips: (
          <div>
            <h3 className="text-xl font-bold text-emerald-700 dark:text-emerald-400 mb-4">نصائح صحية للحجاج والمعتمرين</h3>
            <div className="p-6 bg-gray-50 dark:bg-gray-700 rounded-lg text-center">
              <div className="w-16 h-16 mx-auto bg-emerald-100 dark:bg-emerald-900 rounded-full flex items-center justify-center mb-4">
                <lucide-heart-pulse className="w-8 h-8 text-emerald-600 dark:text-emerald-400" />
              </div>
              <h4 className="text-lg font-bold mb-2">قريباً</h4>
              <p className="text-gray-600 dark:text-gray-400 mb-4">سيتم إضافة قائمة بالنصائح الصحية للحجاج والمعتمرين قريباً</p>
              <button 
                onClick={() => setActiveTab('overview')}
                className="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg"
              >
                العودة للنظرة العامة
              </button>
            </div>
          </div>
        ),
      };
      
      return (
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
          <div className="border-b border-gray-300 dark:border-gray-700 pb-3 mb-4">
            <h2 className="text-2xl font-bold text-center text-emerald-800 dark:text-emerald-500">
              الحج والعمرة
            </h2>
            <p className="text-center text-gray-600 dark:text-gray-400">
              دليل شامل لمناسك الحج والعمرة وكل ما تحتاج معرفته
            </p>
          </div>
          
          <div className="flex flex-wrap justify-center gap-2 mb-6">
            <button 
              onClick={() => setActiveTab('overview')}
              className={`px-3 py-2 rounded-lg text-sm ${activeTab === 'overview' ? 'bg-emerald-600 text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200'}`}
            >
              نظرة عامة
            </button>
            <button 
              onClick={() => setActiveTab('hajj')}
              className={`px-3 py-2 rounded-lg text-sm ${activeTab === 'hajj' ? 'bg-emerald-600 text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200'}`}
            >
              دليل الحج
            </button>
            <button 
              onClick={() => setActiveTab('umrah')}
              className={`px-3 py-2 rounded-lg text-sm ${activeTab === 'umrah' ? 'bg-emerald-600 text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200'}`}
            >
              دليل العمرة
            </button>
            <button 
              onClick={() => setActiveTab('hajj_calendar')}
              className={`px-3 py-2 rounded-lg text-sm ${activeTab === 'hajj_calendar' ? 'bg-emerald-600 text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200'}`}
            >
              تقويم الحج
            </button>
            <button 
              onClick={() => setActiveTab('approved_companies')}
              className={`px-3 py-2 rounded-lg text-sm ${activeTab === 'approved_companies' ? 'bg-emerald-600 text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200'}`}
            >
              الشركات المعتمدة
            </button>
            <button 
              onClick={() => setActiveTab('health_tips')}
              className={`px-3 py-2 rounded-lg text-sm ${activeTab === 'health_tips' ? 'bg-emerald-600 text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200'}`}
            >
              نصائح صحية
            </button>
          </div>
          
          {tabContents[activeTab]}
          
          {toast && (
            <Toast 
              message={toast.message} 
              type={toast.type} 
              onClose={clearToast} 
            />
          )}
        </div>
      );
    };

    // قسم حلقات التحفيظ - ربط مع API
    const MemorizationCircles = () => {
      const [circles, setCircles] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [showJoinForm, setShowJoinForm] = useState(false);
      const [selectedCircle, setSelectedCircle] = useState(null);
      const [toast, setToast] = useState(null);
      const [formData, setFormData] = useState({
        name: '',
        email: '',
        phone: '',
        level: 'مبتدئ',
        message: '',
      });
      
      // جلب بيانات حلقات التحفيظ
      useEffect(() => {
        fetchCircles();
      }, []);
      
      const fetchCircles = async () => {
        setLoading(true);
        setError(null);
        
        try {
          // محاكاة لاستدعاء API - سيتم ربطه بـ API حقيقي في الإصدار النهائي
          setTimeout(() => {
            const mockCircles = [
              { id: 1, name: 'حلقة الإمام نافع', teacher: 'الشيخ أحمد محمد', level: 'متقدم', members: 12, schedule: 'السبت والاثنين 8 مساءً', availableSeats: 3, imgUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJncmFkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzEwQjk4MSIgLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMwNTlkYzciIC8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PGNpcmNsZSBjeD0iNDAiIGN5PSI0MCIgcj0iMzUiIGZpbGw9InVybCgjZ3JhZCkiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIyMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmaWxsPSJ3aGl0ZSI+PN+EPC90ZXh0Pjwvc3ZnPg==' },
              { id: 2, name: 'حلقة تعليم المبتدئين', teacher: 'الشيخ عبدالله محمود', level: 'مبتدئ', members: 20, schedule: 'الأحد والأربعاء 7 مساءً', availableSeats: 5, imgUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJncmFkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzVENUNERSIgLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM4ODc0RjQiIC8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PGNpcmNsZSBjeD0iNDAiIGN5PSI0MCIgcj0iMzUiIGZpbGw9InVybCgjZ3JhZCkiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIyMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmaWxsPSJ3aGl0ZSI+2KjYrTwvdGV4dD48L3N2Zz4=' },
              { id: 3, name: 'حلقة جزء عم', teacher: 'الشيخة نورة الأحمد', level: 'متوسط', members: 15, schedule: 'يوميًا 9 صباحًا', availableSeats: 0, imgUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJncmFkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI0Y5NzMxNiIgLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNGQkE5NEQiIC8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PGNpcmNsZSBjeD0iNDAiIGN5PSI0MCIgcj0iMzUiIGZpbGw9InVybCgjZ3JhZCkiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIyMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmaWxsPSJ3aGl0ZSI+2LnZhTwvdGV4dD48L3N2Zz4=' },
              { id: 4, name: 'حلقة الإتقان والتجويد', teacher: 'الشيخ سعد العمري', level: 'متقدم', members: 8, schedule: 'الثلاثاء والخميس 6 مساءً', availableSeats: 7, imgUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJncmFkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzNBQTk3NyIgLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM2MEJCODkiIC8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PGNpcmNsZSBjeD0iNDAiIGN5PSI0MCIgcj0iMzUiIGZpbGw9InVybCgjZ3JhZCkiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIyMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmaWxsPSJ3aGl0ZSI+2KrYrDwvdGV4dD48L3N2Zz4=' },
              { id: 5, name: 'حلقة سورة البقرة', teacher: 'الشيخ محمد العتيبي', level: 'متوسط', members: 18, schedule: 'السبت والأربعاء 10 صباحًا', availableSeats: 2, imgUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJncmFkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzIxNzREOSIgLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM0N0EzRkYiIC8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PGNpcmNsZSBjeD0iNDAiIGN5PSI0MCIgcj0iMzUiIGZpbGw9InVybCgjZ3JhZCkiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIyMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmaWxsPSJ3aGl0ZSI+2KjZgtwvdGV4dD48L3N2Zz4=' },
              { id: 6, name: 'حلقة تعليم الأطفال', teacher: 'الأستاذة سارة الفهد', level: 'مبتدئ', members: 25, schedule: 'الاثنين والخميس 4 عصرًا', availableSeats: 5, imgUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJncmFkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI0QzMzY3RSIgLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNFODU4OTgiIC8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PGNpcmNsZSBjeD0iNDAiIGN5PSI0MCIgcj0iMzUiIGZpbGw9InVybCgjZ3JhZCkiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIyMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmaWxsPSJ3aGl0ZSI+2KfYt9mB2KfZhDwvdGV4dD48L3N2Zz4=' },
            ];
            
            setCircles(mockCircles);
            setLoading(false);
          }, 1200);
        } catch (error) {
          console.error("خطأ في جلب بيانات حلقات التحفيظ:", error);
          setError("تعذر الحصول على بيانات حلقات التحفيظ. يرجى التحقق من اتصالك بالإنترنت.");
          setLoading(false);
        }
      };
      
      const handleJoinCircle = (circleId) => {
        const circle = circles.find(c => c.id === circleId);
        if (circle) {
          if (circle.availableSeats > 0) {
            setSelectedCircle(circle);
            setShowJoinForm(true);
          } else {
            setToast({
              message: 'عذراً، لا توجد مقاعد متاحة في هذه الحلقة حالياً.',
              type: 'warning'
            });
          }
        }
      };
      
      const handleFormSubmit = (e) => {
        e.preventDefault();
        
        // تحقق من صحة البيانات
        if (!formData.name || !formData.email || !formData.phone) {
          setToast({
            message: 'يرجى ملء جميع الحقول المطلوبة',
            type: 'error'
          });
          return;
        }
        
        // محاكاة إرسال الطلب إلى API
        setLoading(true);
        
        setTimeout(() => {
          setLoading(false);
          setShowJoinForm(false);
          
          // تحديث عدد المقاعد المتاحة
          const updatedCircles = circles.map(circle => {
            if (circle.id === selectedCircle.id) {
              return {
                ...circle,
                availableSeats: circle.availableSeats - 1,
                members: circle.members + 1
              };
            }
            return circle;
          });
          
          setCircles(updatedCircles);
          
          // إظهار رسالة نجاح
          setToast({
            message: `تم تسجيلك بنجاح في حلقة ${selectedCircle.name}. سيتم التواصل معك قريباً.`,
            type: 'success'
          });
          
          // إعادة تعيين نموذج البيانات
          setFormData({
            name: '',
            email: '',
            phone: '',
            level: 'مبتدئ',
            message: '',
          });
        }, 1500);
      };
      
      const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormData({
          ...formData,
          [name]: value
        });
      };

      const clearToast = () => {
        setToast(null);
      };
      
      if (loading && circles.length === 0) {
        return <LoadingSpinner text="جاري تحميل حلقات التحفيظ..." />;
      }
      
      if (error && circles.length === 0) {
        return <ErrorDisplay error={error} onRetry={fetchCircles} />;
      }
      
      return (
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
          <div className="border-b border-gray-300 dark:border-gray-700 pb-3 mb-4">
            <h2 className="text-2xl font-bold text-center text-emerald-800 dark:text-emerald-500">
              حلقات التحفيظ المتاحة
            </h2>
            <p className="text-center text-gray-600 dark:text-gray-400">
              انضم إلى إحدى حلقات التحفيظ وابدأ رحلة التعلم والتحفيظ مع مدرسين متخصصين
            </p>
          </div>
          
          {showJoinForm && selectedCircle ? (
            <div className="max-w-2xl mx-auto bg-white dark:bg-gray-800 rounded-lg p-6 mb-6 border border-gray-200 dark:border-gray-700">
              <div className="flex justify-between items-center mb-4">
                <h3 className="text-xl font-bold text-emerald-700 dark:text-emerald-400">الانضمام إلى حلقة {selectedCircle.name}</h3>
                <button 
                  onClick={() => setShowJoinForm(false)}
                  className="p-1 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"
                >
                  <lucide-x className="w-5 h-5" />
                </button>
              </div>
              
              {loading ? (
                <LoadingSpinner text="جاري إرسال طلبك..." />
              ) : (
                <form onSubmit={handleFormSubmit}>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                      <label htmlFor="name" className="block text-gray-700 dark:text-gray-300 mb-1">الاسم الكامل <span className="text-red-500">*</span></label>
                      <input 
                        type="text" 
                        id="name"
                        name="name"
                        value={formData.name}
                        onChange={handleInputChange}
                        required
                        className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-emerald-500 dark:bg-gray-700 dark:text-white"
                      />
                    </div>
                    <div>
                      <label htmlFor="email" className="block text-gray-700 dark:text-gray-300 mb-1">البريد الإلكتروني <span className="text-red-500">*</span></label>
                      <input 
                        type="email" 
                        id="email"
                        name="email"
                        value={formData.email}
                        onChange={handleInputChange}
                        required
                        className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-emerald-500 dark:bg-gray-700 dark:text-white"
                      />
                    </div>
                    <div>
                      <label htmlFor="phone" className="block text-gray-700 dark:text-gray-300 mb-1">رقم الهاتف <span className="text-red-500">*</span></label>
                      <input 
                        type="tel" 
                        id="phone"
                        name="phone"
                        value={formData.phone}
                        onChange={handleInputChange}
                        required
                        className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-emerald-500 dark:bg-gray-700 dark:text-white"
                      />
                    </div>
                    <div>
                      <label htmlFor="level" className="block text-gray-700 dark:text-gray-300 mb-1">مستواك في الحفظ</label>
                      <select 
                        id="level"
                        name="level"
                        value={formData.level}
                        onChange={handleInputChange}
                        className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-emerald-500 dark:bg-gray-700 dark:text-white"
                      >
                        <option value="مبتدئ">مبتدئ</option>
                        <option value="متوسط">متوسط</option>
                        <option value="متقدم">متقدم</option>
                      </select>
                    </div>
                  </div>
                  
                  <div className="mb-4">
                    <label htmlFor="message" className="block text-gray-700 dark:text-gray-300 mb-1">ملاحظات إضافية</label>
                    <textarea 
                      id="message"
                      name="message"
                      value={formData.message}
                      onChange={handleInputChange}
                      rows="3"
                      className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-emerald-500 dark:bg-gray-700 dark:text-white"
                    ></textarea>
                  </div>
                  
                  <div className="flex justify-end gap-2">
                    <button 
                      type="button"
                      onClick={() => setShowJoinForm(false)}
                      className="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded"
                    >
                      إلغاء
                    </button>
                    <button 
                      type="submit"
                      className="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded"
                    >
                      تأكيد الانضمام
                    </button>
                  </div>
                </form>
              )}
            </div>
          ) : (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              {circles.map(circle => (
                <div key={circle.id} className="memory-circle border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden shadow-md">
                  <div className="bg-gradient-to-r from-emerald-700 to-emerald-900 text-white p-3">
                    <h3 className="font-bold text-lg">{circle.name}</h3>
                  </div>
                  <div className="p-4">
                    <div className="flex items-center mb-3">
                      <img 
                        src={circle.imgUrl} 
                        alt={circle.teacher} 
                        className="w-12 h-12 rounded-full ml-3"
                      />
                      <div>
                        <div className="font-bold">{circle.teacher}</div>
                        <div className="text-sm text-gray-600 dark:text-gray-400">{circle.level}</div>
                      </div>
                    </div>
                    
                    <div className="mb-2">
                      <span className="font-bold ml-2">المواعيد:</span>
                      <span>{circle.schedule}</span>
                    </div>
                    <div className="mb-2">
                      <span className="font-bold ml-2">عدد الأعضاء:</span>
                      <span>{circle.members}</span>
                    </div>
                    <div className="mb-2">
                      <span className="font-bold ml-2">المقاعد المتاحة:</span>
                      <span className={circle.availableSeats > 0 ? 'text-emerald-600 dark:text-emerald-400' : 'text-red-600 dark:text-red-400'}>
                        {circle.availableSeats > 0 ? circle.availableSeats : 'مكتملة'}
                      </span>
                    </div>
                    <div className="flex justify-center">
                      <button 
                        className={`${
                          circle.availableSeats > 0 
                            ? 'bg-emerald-600 hover:bg-emerald-700' 
                            : 'bg-gray-400 cursor-not-allowed'
                        } text-white px-4 py-2 rounded-lg`}
                        onClick={() => handleJoinCircle(circle.id)}
                        disabled={circle.availableSeats === 0}
                      >
                        {circle.availableSeats > 0 ? 'انضمام للحلقة' : 'الحلقة مكتملة'}
                      </button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
          
          <div className="text-center mt-6">
            <button 
              className="bg-amber-600 hover:bg-amber-700 text-white px-6 py-3 rounded-lg"
              onClick={() => setToast({
                message: 'سيتم إتاحة إنشاء حلقات تحفيظ جديدة قريبًا',
                type: 'info'
              })}
            >
              إنشاء حلقة تحفيظ جديدة
            </button>
          </div>
          
          {toast && (
            <Toast 
              message={toast.message} 
              type={toast.type} 
              onClose={clearToast} 
            />
          )}
        </div>
      );
    };

    // التذييل
    const Footer = ({ config }) => {
      return (
        <footer className="mt-auto py-4 border-t border-gray-200 dark:border-gray-700 text-center">
          <div className="container mx-auto px-4">
            <div className="flex flex-col items-center justify-center">
              <p className="text-gray-700 dark:text-gray-300 font-bold">
                {config.copyright.owner}
              </p>
              <div className="flex flex-wrap justify-center gap-x-4 text-sm text-gray-600 dark:text-gray-400 mt-1">
                <a href={`tel:${config.copyright.phone}`} className="hover:text-emerald-600 dark:hover:text-emerald-400">
                  <span className="ml-1">📞</span>
                  {config.copyright.phone}
                </a>
                <a href={`mailto:${config.copyright.email}`} className="hover:text-emerald-600 dark:hover:text-emerald-400">
                  <span className="ml-1">✉️</span>
                  {config.copyright.email}
                </a>
              </div>
              <p className="text-sm text-gray-600 dark:text-gray-400 mt-1">
                {config.copyright.location}
              </p>
              <p className="text-xs text-gray-500 dark:text-gray-500 mt-3">
                {config.copyright.rights} &copy; {config.copyright.year} | الإصدار {config.version}
              </p>
            </div>
          </div>
        </footer>
      );
    };
    
    // التطبيق الرئيسي
    const QuranApp = () => {
      const [darkMode, setDarkMode] = useState(false);
      const [language, setLanguage] = useState('ar');
      const [currentSection, setCurrentSection] = useState('home');
      const [loading, setLoading] = useState(true);
      const [toast, setToast] = useState(null);
      
      useEffect(() => {
        // التحقق من تفضيلات وضع الظلام بالنظام
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          setDarkMode(true);
          document.documentElement.classList.add('dark');
        }
        
        // محاكاة تحميل البيانات
        const timer = setTimeout(() => {
          setLoading(false);
        }, 2000);
        
        // التحقق من وجود Poe API
        if (!window.Poe) {
          console.warn("Poe API is not available. Some features might be limited.");
        }
        
        return () => clearTimeout(timer);
      }, []);
      
      // تبديل وضع الظلام
      const toggleDarkMode = () => {
        setDarkMode(!darkMode);
        if (darkMode) {
          document.documentElement.classList.remove('dark');
        } else {
          document.documentElement.classList.add('dark');
        }
      };
      
      // تغيير اللغة
      const handleLanguageChange = (code) => {
        setLanguage(code);
      };
      
      const clearToast = () => {
        setToast(null);
      };
      
      // عرض القسم الحالي
      const renderCurrentSection = () => {
        switch (currentSection) {
          case 'quran':
            return <QuranSection />;
          case 'dream-interpretation':
            return <DreamInterpretationSection />;
          case 'hajj-umrah':
            return <HajjUmrahSection />;
          case 'memorization':
            return <MemorizationCircles />;
          // الأقسام الأخرى سيتم إضافتها لاحقاً
          case 'learn-reading':
          case 'virtual-classes':
          case 'educational':
          case 'ask-scholars':
            return (
              <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 text-center">
                <lucide-construction className="w-16 h-16 mx-auto mb-4 text-amber-500" />
                <h2 className="text-xl font-bold text-emerald-700 dark:text-emerald-400 mb-4">
                  قسم {
                    currentSection === 'learn-reading' ? 'تعلم القراءة' :
                    currentSection === 'virtual-classes' ? 'الفصول الافتراضية' :
                    currentSection === 'educational' ? 'المواد التعليمية' :
                    'التواصل مع العلماء'
                  }
                </h2>
                <p className="text-gray-600 dark:text-gray-400 mb-6">
                  هذا القسم قيد الإنشاء وسيتم إضافته قريبًا بإذن الله.
                </p>
                <button 
                  onClick={() => setCurrentSection('home')}
                  className="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg"
                >
                  العودة للرئيسية
                </button>
              </div>
            );
          default:
            return (
              <>
                <PrayerTimes />
                <MainSections onSectionSelect={setCurrentSection} />
                <LastReading />
              </>
            );
        }
      };
      
      if (loading) {
        return (
          <div className="fixed inset-0 flex flex-col items-center justify-center bg-gradient-to-b from-emerald-900 to-emerald-700 z-50">
            <div className="text-center">
              <div className="mb-8">
                <div className="w-24 h-24 mx-auto mb-4 rounded-full bg-white bg-opacity-20 flex items-center justify-center animate-pulse">
                  <span className="text-5xl">📖</span>
                </div>
                <h1 className="text-4xl font-bold text-white">تطبيق القرآن الكريم التعليمي</h1>
                <p className="text-xl text-white mt-2">المنصة الشاملة للتعليم والتحفيظ</p>
              </div>
              
              <div className="w-64 h-2 bg-white bg-opacity-30 rounded-full mx-auto overflow-hidden relative">
                <div className="h-full bg-white rounded-full absolute left-0 top-0 animate-pulse" style={{ width: '60%' }}></div>
              </div>
              
              <div className="mt-8 text-white">
                <p className="text-lg font-bold">{APP_CONFIG.developer}</p>
                <p className="text-sm mt-1">
                  <span className="ml-1">📞</span> {APP_CONFIG.copyright.phone} |
                  <span className="ml-1">✉️</span> {APP_CONFIG.copyright.email}
                </p>
                <p className="text-sm mt-1">{APP_CONFIG.copyright.location}</p>
                <p className="text-xs mt-3">{APP_CONFIG.copyright.rights} &copy; {APP_CONFIG.copyright.year}</p>
              </div>
            </div>
          </div>
        );
      }
      
      return (
        <div className={`min-h-screen flex flex-col ${darkMode ? 'dark bg-gray-900 text-white' : 'bg-gray-100 text-gray-900'}`} dir={LANGUAGES.find(lang => lang.code === language)?.direction || 'rtl'}>
          {/* رأس الصفحة */}
          <header className="bg-emerald-700 dark:bg-emerald-900 text-white py-2 px-4 shadow-md sticky top-0 z-10">
            <div className="container mx-auto flex flex-wrap justify-between items-center">
              <div className="flex items-center space-x-4 rtl:space-x-reverse">
                <div className="flex items-center cursor-pointer" onClick={() => setCurrentSection('home')}>
                  <span className="text-2xl ml-2">📖</span>
                  <span className="font-bold hidden md:block">{APP_CONFIG.name}</span>
                </div>
                
                <div className="flex items-center">
                  <label htmlFor="language" className="text-sm font-medium text-white ml-2">اللغة:</label>
                  <select 
                    id="language" 
                    value={language}
                    onChange={(e) => handleLanguageChange(e.target.value)}
                    className="bg-emerald-800 text-white rounded border border-emerald-900 text-sm py-1"
                  >
                    {LANGUAGES.map(lang => (
                      <option key={lang.code} value={lang.code}>{lang.name}</option>
                    ))}
                  </select>
                </div>
              </div>
              
              <div className="flex items-center">
                <button
                  onClick={toggleDarkMode}
                  className="p-2 rounded-full bg-emerald-800 hover:bg-emerald-900"
                  aria-label={darkMode ? "تبديل إلى الوضع النهاري" : "تبديل إلى الوضع الليلي"}
                >
                  {darkMode ? <lucide-sun className="w-5 h-5" /> : <lucide-moon className="w-5 h-5" />}
                </button>
              </div>
            </div>
          </header>
          
          {/* المحتوى الرئيسي */}
          <main className="container mx-auto px-4 py-6 flex-grow">
            {currentSection !== 'home' && (
              <div className="mb-4">
                <button 
                  onClick={() => setCurrentSection('home')}
                  className="flex items-center text-emerald-600 dark:text-emerald-400 hover:underline"
                >
                  <span className="mr-1 rtl:order-1">→</span>
                  العودة للرئيسية
                </button>
              </div>
            )}
            
            {renderCurrentSection()}
          </main>
          
          {/* التذييل */}
          <Footer config={APP_CONFIG} />
          
          {toast && (
            <Toast 
              message={toast.message} 
              type={toast.type} 
              onClose={clearToast} 
            />
          )}
        </div>
      );
    };

    // Render the app
    ReactDOM.render(<QuranApp />, document.getElementById('app'));
  </script>


</body></html>